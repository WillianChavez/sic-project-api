(()=>{var e={46:(e,t,r)=>{var n=r(17),o=r(977),a=r(354),i=(r(510),r(59)),s=r(582);e.exports={entry:{server:"./app.mjs"},output:{path:n.join(__dirname,"dist"),publicPath:"/",filename:"[name].js"},mode:"development",target:"node",node:{__dirname:!1,__filename:!1},externals:[o()],resolve:{extensions:[".js",".mjs"],alias:{"@app":n.resolve(__dirname,"app/"),"@config":n.resolve(__dirname,"config/"),"@handlers":n.resolve(__dirname,"handlers/"),"@public":n.resolve(__dirname,"public/"),"@routes":n.resolve(__dirname,"routes/"),"@test":n.resolve(__dirname,"test/")}},module:{rules:[{test:/\.(mjs|js)$/,exclude:/node_modules/,use:{loader:"babel-loader"}}]},plugins:[new a.HotModuleReplacementPlugin,new i,new s]}},59:e=>{"use strict";e.exports=require("dotenv-webpack")},582:e=>{"use strict";e.exports=require("eslint-webpack-plugin")},510:e=>{"use strict";e.exports=require("html-webpack-plugin")},354:e=>{"use strict";e.exports=require("webpack")},977:e=>{"use strict";e.exports=require("webpack-node-externals")},17:e=>{"use strict";e.exports=require("path")}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,r),a.exports}(()=>{"use strict";const e=require("dotenv");var t=r(17),n=".env.".concat("development");e.config({path:t.resolve(n)});const o=require("@babel/runtime/helpers/classCallCheck"),a=require("@babel/runtime/helpers/createClass");var i=r(354);const s=require("webpack-dev-middleware"),u=require("webpack-hot-middleware");var c=r(46);const l=require("express"),p=require("ajv"),d=require("ajv-formats"),f=require("ajv-errors"),m=require("ajv-dates"),h={$id:"http://example.com/schemas/defs.json#",definitions:{integer:{type:"integer"},intPositivo:{type:"integer",minimun:1},intOrNull:{type:["null","integer"]},double:{type:"number"},string:{type:"string"},stringOrNull:{type:["null","string"]},date:{type:"string",format:"date",errorMessage:{format:"El formato de la fecha es YYYY-MM-DD"}},fechaMenorActual:{type:"string",format:"date",isAfter:Date.now(),errorMessage:{format:"El formato de la fecha es YYYY-MM-DD",properties:{isAfter:"La fecha debe ser mayor a la actual"}}},email:{type:"string",pattern:"^([a-zA-Z0-9./^S+$/<*>!#$%&'+/=?^_`{|}~-]+([s]{0}))+?@[a-zA-Z]+([.]{1})[a-zA-Z]+[s]{0}[.]?[a-zA-Z]{2,}([.]{0})[s]{0}$",errorMessage:{type:"El correo electronico debe ser alfanumerico ",pattern:"Tiene que ingresar un correo valido"}},password:{type:"string",pattern:"^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[$@#$!%*?&-_.:])([A-Za-zd$@$!%*?&]|[^ d]){8,20}$",errorMessage:{pattern:"La contraseña debe tener entre 8 y 16 caracteres, al menos un dígito, al menos una minúscula, al menos una mayúscula y al menos un caracter no alfanumérico."}},decimal:{type:"string",pattern:"^[0-9]+([.][0-9]+)?$",errorMessage:{type:"Debe ser decimal",pattern:"EL campo debe ser un entero o decimal."}},arrayIntUnico:{type:"array",uniqueItems:!0,items:{type:"integer"},errorMessage:{uniqueItems:"No puede existir paramatros identicos en el array"}},arrayInt:{type:"array",minItems:1,items:{type:"integer"}},arrayString:{type:"array",minItems:1,items:{type:"string"}},codigo:{type:["null","string"],maxLength:5,errorMessage:{type:"El codigo del perfil debe ser de tipo alfanumérico",maxLength:"El codigo debe ser maximo 5 caracteres"}}}};var y=(0,m.dates)(new p({allErrors:!0,$data:!0}));d(y),f(y),y.addSchema(h);const v=y,b=require("@babel/runtime/helpers/defineProperty");var _=a((function e(){o(this,e)}));b(_,"HTTP_OK",200),b(_,"HTTP_CREATED",201),b(_,"HTTP_BAD_REQUEST",400),b(_,"HTTP_UNAUTHORIZED",401),b(_,"HTTP_FORBIDDEN",403),b(_,"HTTP_NOT_FOUND",404),b(_,"HTTP_UNPROCESSABLE_ENTITY",422),b(_,"HTTP_NOT_MODIFIED",304),b(_,"HTTP_INTERNAL_SERVER_ERROR",500);const w=require("@babel/runtime/helpers/assertThisInitialized"),x=require("@babel/runtime/helpers/inherits"),g=require("@babel/runtime/helpers/possibleConstructorReturn"),E=require("@babel/runtime/helpers/getPrototypeOf");var k=function(e){x(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=E(t);if(r){var o=E(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return g(this,e)});function i(e,t,r){var a,s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return o(this,i),a=n.call(this,r),Object.setPrototypeOf(w(a),(this instanceof i?this.constructor:void 0).prototype),a.name=e,a.description=r,a.statusCode=t,a.isOperational=s,Error.captureStackTrace(w(a)),a}return a(i)}(require("@babel/runtime/helpers/wrapNativeSuper")(Error));const T=require("mongoose"),O=require("@babel/runtime/helpers/asyncToGenerator"),R=require("@babel/runtime/regenerator");var N=process.env.MONGOOSE_USERNAME,S=process.env.MONGOOSE_PASSWORD,j=process.env.MONGOOSE_HOST,q=process.env.MONGOOSE_PORT,P=process.env.MONGOSE_DATABASE,A=("mongodb://".concat(N,":").concat(S,"@").concat(j,":").concat(q,"/").concat(P),function(){function e(){o(this,e)}var t;return a(e,null,[{key:"connection",value:(t=O(R.mark((function e(){return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),console.log(e.t0);case 9:case"end":return e.stop()}}),e,null,[[1,6]])}))),function(){return t.apply(this,arguments)})}]),e}()),I=new(0,T.Schema)({id_bitacora:String,codigo:Number,mensaje:String,trace:String,content:Object,fecha_hora_reg:{type:Date,default:Date.now()}});A.connection(),T.model("error",I,"errors");var z=function(){function e(){o(this,e)}return a(e,null,[{key:"logError",value:function(e,t){e.usuario}},{key:"logErrorMiddleware",value:function(t,r,n,o){e.logError(r,t),o(t)}},{key:"handlerError",value:function(t,r,n,o){var a,i,s,u=(a=e,i=e,s=M,function(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}(a,i),s).call(e,t);return t.statusCode&&(u=t.statusCode),n.status(u).json({err:t,stack:t.stack})}},{key:"isOPerationalError",value:function(e){return e instanceof k&&e.isOperational}}]),e}();function M(e){var t={badRequest:{names:["SequelizeValidationError","JsonSchemaValidation","SequelizeUniqueConstraintError"],code:_.HTTP_BAD_REQUEST},unauthorized:{names:["TokenExpiredError","JsonWebTokenError"],code:_.HTTP_UNAUTHORIZED},internal:{names:["SequelizeForeignKeyConstraintError"],code:_.HTTP_INTERNAL_SERVER_ERROR}};for(var r in t)if(t[r].names.includes(e.name))return t[r].code;return _.HTTP_INTERNAL_SERVER_ERROR}const K=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"body",r=v.compile(e);return function(e,n,o){if(!r(e[t])){var a=r.errors,i={message:"BAD REQUEST",statusCode:_.HTTP_BAD_REQUEST,content:a};z.logError(e,i),console.log(a);var s=a.map((function(e){var t={};return t.message=e.message,t}));return n.status(_.HTTP_BAD_REQUEST).json(s)}o()}},D=require("bcryptjs"),C=require("moment-timezone"),L=require("jsonwebtoken"),B=require("speakeasy"),H=require("sequelize"),G={connections:{postgres:{motor:"postgres",options:{db_host:"localhost",db_port:"5434",db_name:"sic",db_username:"postgres",db_password:"root"}}},default:"postgres"};var U=function(){function e(){o(this,e)}var t;return a(e,null,[{key:"connection",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=G.default;return e=t?G.connections[t]:G.connections[r],new H.Sequelize(e.options.db_name,e.options.db_username,e.options.db_password,{host:e.options.db_host,port:e.options.db_port,dialect:e.motor,logging:"true"===process.env.DB_LOGGER})}},{key:"testing",value:(t=O(R.mark((function e(){var t,r=arguments;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:null,e.prev=1,e.next=4,this.connection(t).authenticate();case 4:return e.abrupt("return",!0);case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return",!1);case 10:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(){return t.apply(this,arguments)})}]),e}();var $=function(e){x(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=E(t);if(r){var o=E(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return g(this,e)});function i(){return o(this,i),n.apply(this,arguments)}return a(i)}(H.Model);$.init({id:{type:H.Sequelize.INTEGER,primaryKey:!0,autoIncrement:!0},id_ruta:{type:H.Sequelize.INTEGER},id_rol:{type:H.Sequelize.INTEGER}},{timestamps:!1,updatedAt:!1,sequelize:U.connection(),tableName:"mnt_ruta_rol"});const F=$;var V=function(e){x(s,e);var t,r,n,i=(r=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=E(r);if(n){var o=E(this).constructor;e=Reflect.construct(t,arguments,o)}else e=t.apply(this,arguments);return g(this,e)});function s(){return o(this,s),i.apply(this,arguments)}return a(s,[{key:"toJSON",value:function(){return{id:this.id,nombre:this.nombre,uri:this.uri,nombre_uri:this.nombre_uri,icono:this.icono,admin:this.admin,mostrar:this.mostrar,orden:this.orden,id_ruta_padre:this.id_ruta_padre,childrens:this.rutas}}}],[{key:"associate",value:function(){this.belongsToMany(ie,{through:F,foreignKey:"id_ruta",otherKey:"id_rol",onDelete:"CASCADE",hooks:!0,as:"roles_ruta"}),this.hasMany(s,{foreignKey:"id_ruta_padre",as:"ruta_padre"}),this.hasOne(s,{foreignKey:"id_ruta_padre",as:"ruta_padre_2"})}},{key:"getById",value:(t=O(R.mark((function e(t){return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.findOne({where:{id:t},attributes:["id"],include:[{model:ie,attributes:["id","name"],through:{attributes:[]}}]}));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),s}(H.Model);V.init({id:{type:H.Sequelize.INTEGER,primaryKey:!0,autoIncrement:!0},nombre:{type:H.Sequelize.STRING(50),allowNull:!1},uri:{type:H.Sequelize.TEXT},nombre_uri:{type:H.Sequelize.TEXT},mostrar:{type:H.Sequelize.BOOLEAN,allowNull:!1},icono:{type:H.Sequelize.STRING(255)},orden:{type:H.Sequelize.INTEGER},admin:{type:H.Sequelize.BOOLEAN},publico:{type:H.Sequelize.BOOLEAN},id_ruta_padre:{type:H.Sequelize.INTEGER}},{timestamps:!1,sequelize:U.connection(),tableName:"mnt_ruta"});const Z=V;var Q=function(e){x(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=E(t);if(r){var o=E(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return g(this,e)});function i(){return o(this,i),n.apply(this,arguments)}return a(i)}(H.Model);Q.init({id:{type:H.Sequelize.INTEGER,primaryKey:!0,autoIncrement:!0},id_perfil:{type:H.Sequelize.INTEGER,allowNull:!1},id_usuario:{type:H.Sequelize.INTEGER}},{timestamps:!1,updatedAt:!1,sequelize:U.connection(),tableName:"mnt_usuario_perfil"});const Y=Q;var J=function(e){x(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=E(t);if(r){var o=E(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return g(this,e)});function i(){return o(this,i),n.apply(this,arguments)}return a(i)}(H.Model);J.init({id:{type:H.Sequelize.INTEGER,primaryKey:!0,autoIncrement:!0},id_perfil:{type:H.Sequelize.INTEGER},id_rol:{type:H.Sequelize.INTEGER}},{timestamps:!1,updatedAt:!1,sequelize:U.connection(),tableName:"mnt_perfil_rol"});const W=J;var X=function(e){x(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=E(t);if(r){var o=E(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return g(this,e)});function i(){return o(this,i),n.apply(this,arguments)}return a(i,[{key:"toJSON",value:function(){return{id:this.id,codigo:this.codigo,nombre:this.nombre,roles:this.Rols}}}],[{key:"associate",value:function(){this.belongsToMany(ye,{through:Y,foreignKey:"id_perfil",otherKey:"id_usuario",as:"usuarios_perfil"}),this.belongsToMany(ie,{through:W,foreignKey:"id_perfil",otherKey:"id_rol",as:"roles_perfil"})}}]),i}(H.Model);X.init({id:{type:H.Sequelize.INTEGER,primaryKey:!0,autoIncrement:!0},nombre:{type:H.Sequelize.STRING(30),allowNull:!1},codigo:{type:H.Sequelize.STRING(5)}},{timestamps:!1,sequelize:U.connection(),tableName:"mnt_perfil"});const ee=X;var te=function(e){x(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=E(t);if(r){var o=E(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return g(this,e)});function i(){return o(this,i),n.apply(this,arguments)}return a(i)}(H.Model);te.init({id_usuario:{type:H.Sequelize.INTEGER,primaryKey:!0},id_rol:{type:H.Sequelize.INTEGER,primaryKey:!0}},{timestamps:!1,updatedAt:!1,sequelize:U.connection(),tableName:"mnt_usuario_rol"});const re=te;var ne=function(e){x(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=E(t);if(r){var o=E(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return g(this,e)});function i(){return o(this,i),n.apply(this,arguments)}return a(i,null,[{key:"associate",value:function(){this.hasMany(ie,{foreignKey:"id_tipo_rol",as:"roles_tipo_rol"})}}]),i}(H.Model);ne.init({id:{type:H.Sequelize.INTEGER,primaryKey:!0,autoIncrement:!0},name:{type:H.Sequelize.STRING(255),allowNull:!1},prefijo:{type:H.Sequelize.STRING(255),allowNull:!1}},{timestamps:!1,sequelize:U.connection(),tableName:"ctl_tipo_rol"});const oe=ne;var ae=function(e){x(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=E(t);if(r){var o=E(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return g(this,e)});function i(){return o(this,i),n.apply(this,arguments)}return a(i,null,[{key:"associate",value:function(){this.belongsToMany(Z,{through:F,foreignKey:"id_rol",otherKey:"id_ruta",as:"ruta_rol_rol"}),this.belongsToMany(ee,{through:W,foreignKey:"id_rol",otherKey:"id_perfil",as:"perfil_rol_rol"}),this.belongsToMany(ye,{through:re,foreignKey:"id_rol",otherKey:"id_usuario",as:"usuario_rol_rol"}),this.belongsTo(oe,{foreignKey:"id_tipo_rol",as:"tipo_rol_rol"})}}]),i}(H.Model);ae.init({id:{type:H.Sequelize.INTEGER,primaryKey:!0,autoIncrement:!0},name:{type:H.Sequelize.STRING(255),allowNull:!1},id_tipo_rol:{type:H.Sequelize.INTEGER,allowNull:!1}},{timestamps:!1,sequelize:U.connection(),tableName:"mnt_rol"});const ie=ae;var se=function(e){x(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=E(t);if(r){var o=E(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return g(this,e)});function i(){return o(this,i),n.apply(this,arguments)}return a(i,null,[{key:"associate",value:function(){this.belongsTo(ye,{foreignKey:"id_usuario",as:"usuario_refreshtoken"})}}]),i}(H.Model),ue={id:{type:H.Sequelize.INTEGER,primaryKey:!0,autoIncrement:!0},refresh_token:{type:H.Sequelize.STRING},id_usuario:{type:H.Sequelize.INTEGER,allowNull:!1,references:{model:"mnt_usuario",key:"id"}},valid:{type:H.Sequelize.DATE}};se.init(ue,{timestamps:!1,tableName:"refresh_tokens",sequelize:U.connection()});const ce=se;var le=function(e){x(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=E(t);if(r){var o=E(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return g(this,e)});function i(){return o(this,i),n.apply(this,arguments)}return a(i)}(H.Model);le.init({id:{type:H.Sequelize.INTEGER,primaryKey:!0,autoIncrement:!0},id_usuario:{type:H.Sequelize.INTEGER},id_metodo:{type:H.Sequelize.INTEGER},secret_key:{type:H.Sequelize.STRING},temporal_key:{type:H.Sequelize.STRING},is_primary:{type:H.Sequelize.BOOLEAN},verified:{type:H.Sequelize.BOOLEAN}},{timestamps:!1,sequelize:U.connection(),tableName:"mnt_metodo_autenticacion_usuario"});const pe=le;var de=function(e){x(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=E(t);if(r){var o=E(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return g(this,e)});function i(){return o(this,i),n.apply(this,arguments)}return a(i,[{key:"toJSON",value:function(){var e,t;return{id:this.id,nombre:this.nombre,descripcion:this.descripcion,icono:this.icono,is_primary:(null===(e=this.MetodoAutenticacionUsuario)||void 0===e?void 0:e.is_primary)||!1,verified:null===(t=this.MetodoAutenticacionUsuario)||void 0===t?void 0:t.verified,configured:!!this.MetodoAutenticacionUsuario}}}],[{key:"associate",value:function(){this.belongsToMany(ye,{through:pe,foreignKey:"id_metodo",otherKey:"id_usuario",as:"usuarios"}),this.hasOne(pe,{foreignKey:"id_metodo",as:"MetodoAutenticacionUsuario"})}}]),i}(H.Model);de.init({id:{type:H.Sequelize.INTEGER,primaryKey:!0,autoIncrement:!0},nombre:{type:H.Sequelize.STRING},descripcion:{type:H.Sequelize.STRING},icono:{type:H.Sequelize.STRING}},{timestamps:!1,sequelize:U.connection(),tableName:"mnt_metodo_autenticacion"});const fe=de;var me={id:{type:H.Sequelize.INTEGER,primaryKey:!0,autoIncrement:!0},email:{type:H.Sequelize.STRING},password:{type:H.Sequelize.TEXT},last_login:{type:H.Sequelize.STRING},is_suspended:{type:H.Sequelize.BOOLEAN},token_valid_after:{type:H.Sequelize.STRING},two_factor_status:{type:H.Sequelize.BOOLEAN},verified:{type:H.Sequelize.BOOLEAN},nombre:{type:H.Sequelize.STRING}},he=function(e){x(s,e);var t,r,n,i=(r=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=E(r);if(n){var o=E(this).constructor;e=Reflect.construct(t,arguments,o)}else e=t.apply(this,arguments);return g(this,e)});function s(){return o(this,s),i.apply(this,arguments)}return a(s,[{key:"toJSON",value:function(){return{id:this.id,email:this.email,last_login:this.last_login,is_suspended:this.is_suspended,perfiles:this.Perfils,roles:this.Rols,nombre:this.nombre}}}],[{key:"associate",value:function(){this.belongsToMany(ie,{through:re,foreignKey:"id_usuario",otherKey:"id_rol",as:"roles_usuario_usuario"}),this.belongsToMany(fe,{through:pe,foreignKey:"id_usuario",otherKey:"id_metodo",as:"metodos_autenticacion_usuario"}),this.hasMany(ce,{foreignKey:"id_usuario",as:"refresh_tokens_usuario"}),this.belongsToMany(ee,{through:Y,foreignKey:"id_usuario",otherKey:"id_perfil",as:"perfiles_usuario_usuario"})}},{key:"getById",value:(t=O(R.mark((function e(t){return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.findOne({where:{id:t},attributes:["id","email"],include:[{model:ee,attributes:["id","nombre"],through:{attributes:[]}},{model:ie,attributes:["id","name"],through:{attributes:[]}}]}));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),s}(H.Model);he.init(me,{timestamps:!0,updatedAt:!1,createdAt:"created_at",sequelize:U.connection(),tableName:"mnt_usuario"});const ye=he;var ve=function(e){x(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=E(t);if(r){var o=E(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return g(this,e)});function i(){return o(this,i),n.apply(this,arguments)}return a(i,null,[{key:"associate",value:function(){this.hasMany(we,{foreignKey:"id_tipo_cuenta",as:"cuentas"})}}]),i}(H.Model);ve.init({id:{type:H.Sequelize.INTEGER,primaryKey:!0,autoIncrement:!0},nombre:{type:H.Sequelize.STRING(250),allowNull:!1},codigo:{type:H.Sequelize.STRING(20),allowNull:!1}},{timestamps:!1,sequelize:U.connection(),tableName:"ctl_tipo_cuenta"});const be=ve;var _e=function(e){x(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=E(t);if(r){var o=E(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return g(this,e)});function i(){return o(this,i),n.apply(this,arguments)}return a(i,null,[{key:"associate",value:function(){this.belongsTo(be,{foreignKey:"id_tipo_cuenta",as:"tipo_cuenta_cuenta"}),this.hasMany(De,{foreignKey:"id_cuenta",hooks:!0,onDelete:"CASCADE",as:"transaccion_cuenta"})}}]),i}(H.Model);_e.init({id:{type:H.Sequelize.INTEGER,primaryKey:!0,autoIncrement:!0},id_tipo_cuenta:{type:H.Sequelize.INTEGER,allowNull:!1,references:{model:"ctl_tipo_cuenta",key:"id"}},nombre:{type:H.Sequelize.STRING(250),allowNull:!1},codigo:{type:H.Sequelize.STRING(20),allowNull:!1},requerido:{type:H.Sequelize.BOOLEAN,allowNull:!1,defaultValue:!1},created_at:{type:H.Sequelize.DATE,allowNull:!1,defaultValue:H.Sequelize.literal("CURRENT_TIMESTAMP")},updated_at:{type:H.Sequelize.DATE,allowNull:!0,defaultValue:H.Sequelize.literal("CURRENT_TIMESTAMP")},deleted_at:{type:H.Sequelize.DATE,allowNull:!0}},{timestamps:!0,createdAt:"created_at",updatedAt:"updated_at",deletedAt:"deleted_at",paranoid:!0,sequelize:U.connection(),tableName:"mnt_cuenta"});const we=_e;var xe=function(e){x(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=E(t);if(r){var o=E(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return g(this,e)});function i(){return o(this,i),n.apply(this,arguments)}return a(i,null,[{key:"associate",value:function(){this.hasMany(Ne,{foreignKey:"id_tipo_contribuyente",as:"compra_tipo_contribuyente"}),this.hasMany(Oe,{foreignKey:"id_tipo_contribuyente",as:"servicio_tipo_contribuyente"})}}]),i}(H.Model);xe.init({id:{type:H.Sequelize.INTEGER,primaryKey:!0,autoIncrement:!0},nombre:{type:H.Sequelize.STRING,allowNull:!1}},{timestamps:!1,sequelize:U.connection(),tableName:"ctl_tipo_contribuyente"});const ge=xe;var Ee=function(e){x(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=E(t);if(r){var o=E(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return g(this,e)});function i(){return o(this,i),n.apply(this,arguments)}return a(i,null,[{key:"associate",value:function(){this.hasMany(Oe,{foreignKey:"id_tipo_emision_documento",as:"servicio_tipo_emision_documento"})}}]),i}(H.Model);Ee.init({id:{type:H.Sequelize.INTEGER,primaryKey:!0,autoIncrement:!0},nombre:{type:H.Sequelize.STRING,allowNull:!1}},{timestamps:!1,sequelize:U.connection(),tableName:"ctl_tipo_emision_documento"});const ke=Ee;var Te=function(e){x(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=E(t);if(r){var o=E(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return g(this,e)});function i(){return o(this,i),n.apply(this,arguments)}return a(i,null,[{key:"associate",value:function(){this.belongsTo(ge,{foreignKey:"id_tipo_contribuyente",as:"tipo_contribuyente"}),this.belongsTo(ke,{foreignKey:"id_tipo_emision_documento",as:"tipo_emision_documento"}),this.belongsTo(Ie,{foreignKey:"id_cliente",as:"cliente"}),this.hasOne(je,{foreignKey:"id_servicio",hooks:!0,onDelete:"CASCADE",as:"detalle_venta"}),this.belongsTo(Me,{foreignKey:"id_transaccion",as:"transaccion_servicio"})}}]),i}(H.Model);Te.init({id:{type:H.Sequelize.INTEGER,primaryKey:!0,autoIncrement:!0},id_tipo_contribuyente:{type:H.Sequelize.INTEGER,allowNull:!1,references:{model:"ctl_tipo_contribuyente",key:"id"}},id_transaccion:{type:H.Sequelize.INTEGER,allowNull:!1,references:{model:"mnt_transaccion",key:"id"}},id_Servicio:{type:H.Sequelize.INTEGER,allowNull:!1,references:{model:"mnt_Servicio",key:"id"}},id_tipo_emision_documento:{type:H.Sequelize.INTEGER,allowNull:!1,references:{model:"ctl_tipo_emision_documento",key:"id"}},id_cliente:{type:H.Sequelize.INTEGER,allowNull:!1,references:{model:"mnt_persona",key:"id"}},fecha:{type:H.Sequelize.DATE,allowNull:!1},descripcion:{type:H.Sequelize.STRING(250),allowNull:!1}},{timestamps:!1,sequelize:U.connection(),tableName:"mnt_servicio"});const Oe=Te;var Re=function(e){x(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=E(t);if(r){var o=E(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return g(this,e)});function i(){return o(this,i),n.apply(this,arguments)}return a(i,null,[{key:"associate",value:function(){this.belongsTo(ge,{foreignKey:"id_tipo_contribuyente",as:"tipo_contribuyente_compra"}),this.hasOne(Pe,{foreignKey:"id_compra",hooks:!0,onDelete:"CASCADE",as:"detalle_compra"}),this.belongsTo(Ie,{foreignKey:"id_proveedor",as:"proveedor"}),this.belongsTo(Me,{foreignKey:"id_transaccion",as:"transaccion_compra"})}}]),i}(H.Model);Re.init({id:{type:H.Sequelize.INTEGER,primaryKey:!0,autoIncrement:!0},id_transaccion:{type:H.Sequelize.INTEGER,allowNull:!1,references:{model:"mnt_transaccion",key:"id"}},id_tipo_contribuyente:{type:H.Sequelize.INTEGER,allowNull:!1,references:{model:"ctl_tipo_contribuyente",key:"id"}},fecha_emision:{type:H.Sequelize.DATE,allowNull:!1},descripcion:{type:H.Sequelize.STRING(250),allowNull:!1},numero_documento_ccf:{type:H.Sequelize.STRING(20),allowNull:!1},id_proveedor:{type:H.Sequelize.INTEGER,allowNull:!1,references:{model:"mnt_persona",key:"id"}},es_sujeto_excluido:{type:H.Sequelize.BOOLEAN,allowNull:!1}},{timestamps:!1,sequelize:U.connection(),tableName:"mnt_compra"});const Ne=Re;var Se=function(e){x(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=E(t);if(r){var o=E(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return g(this,e)});function i(){return o(this,i),n.apply(this,arguments)}return a(i,null,[{key:"associate",value:function(){this.belongsTo(Oe,{foreignKey:"id_servicio",as:"servicio"})}}]),i}(H.Model);Se.init({id:{type:H.Sequelize.INTEGER,primaryKey:!0,autoIncrement:!0},id_servicio:{type:H.Sequelize.INTEGER,allowNull:!1,references:{model:"mnt_servicio",key:"id"}},numero_factura:{type:H.Sequelize.STRING(20),allowNull:!1},gravado_local:{type:H.Sequelize.DECIMAL(20,2),allowNull:!0},cantidad_exento:{type:H.Sequelize.DECIMAL(20,2),allowNull:!1},cantidad_no_sujeta:{type:H.Sequelize.DECIMAL(20,2),allowNull:!0},gravado_exportacion:{type:H.Sequelize.DECIMAL(20,2),allowNull:!0},total_ventas:{type:H.Sequelize.DECIMAL(20,2),allowNull:!1},anticipo_uno_porciento_retenido:{type:H.Sequelize.DECIMAL(20,2),allowNull:!0}},{timestamps:!1,sequelize:U.connection(),tableName:"mnt_detalle_venta"});const je=Se;var qe=function(e){x(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=E(t);if(r){var o=E(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return g(this,e)});function i(){return o(this,i),n.apply(this,arguments)}return a(i,null,[{key:"associate",value:function(){this.belongsTo(Ne,{foreignKey:"id_compra",as:"compra"})}}]),i}(H.Model);qe.init({id:{type:H.Sequelize.INTEGER,primaryKey:!0,autoIncrement:!0},id_compra:{type:H.Sequelize.INTEGER,allowNull:!1,references:{model:"mnt_compra",key:"id"}},gravado_interno:{type:H.Sequelize.DECIMAL(10,2),allowNull:!1},exento_interno:{type:H.Sequelize.DECIMAL(10,2),allowNull:!0},exento_importacion:{type:H.Sequelize.DECIMAL(10,2),allowNull:!0},compras_sujeto_excluido:{type:H.Sequelize.DECIMAL(10,2),allowNull:!1},anticipo_uno_porciento_retenido:{type:H.Sequelize.DECIMAL(10,2),allowNull:!0}},{timestamps:!1,sequelize:U.connection(),tableName:"mnt_detalle_compra"});const Pe=qe;var Ae=function(e){x(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=E(t);if(r){var o=E(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return g(this,e)});function i(){return o(this,i),n.apply(this,arguments)}return a(i,null,[{key:"associate",value:function(){this.hasMany(Ne,{foreignKey:"id_proveedor",as:"compra_proveedor"}),this.hasMany(Oe,{foreignKey:"id_cliente",as:"servicio_cliente"})}}]),i}(H.Model);Ae.init({id:{type:H.Sequelize.INTEGER,primaryKey:!0,autoIncrement:!0},nombre:{type:H.Sequelize.STRING(250),allowNull:!1},nit:{type:H.Sequelize.STRING(20),allowNull:!1},nrc:{type:H.Sequelize.STRING(20),allowNull:!0}},{timestamps:!1,sequelize:U.connection(),tableName:"mnt_persona"});const Ie=Ae;var ze=function(e){x(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=E(t);if(r){var o=E(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return g(this,e)});function i(){return o(this,i),n.apply(this,arguments)}return a(i,null,[{key:"associate",value:function(){this.hasOne(Oe,{foreignKey:"id_transaccion",hooks:!0,onDelete:"CASCADE",as:"servicio_transaccion"}),this.hasOne(Ne,{foreignKey:"id_transaccion",hooks:!0,onDelete:"CASCADE",as:"compra_transaccion"}),this.hasMany(De,{foreignKey:"id_transaccion",hooks:!0,onDelete:"CASCADE",as:"transaccion_cuenta"})}}]),i}(H.Model);ze.init({id:{type:H.Sequelize.INTEGER,primaryKey:!0,autoIncrement:!0}},{timestamps:!1,sequelize:U.connection(),tableName:"mnt_transaccion"});const Me=ze;var Ke=function(e){x(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=E(t);if(r){var o=E(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return g(this,e)});function i(){return o(this,i),n.apply(this,arguments)}return a(i,null,[{key:"associate",value:function(){this.belongsTo(Me,{foreignKey:"id_transaccion",as:"transaccion_cuenta_transaccion"}),this.belongsTo(we,{foreignKey:"id_cuenta",as:"transaccion_cuenta_cuenta"})}}]),i}(H.Model);Ke.init({id:{type:H.Sequelize.INTEGER,primaryKey:!0,autoIncrement:!0},id_transaccion:{type:H.Sequelize.INTEGER,allowNull:!1,references:{model:"mnt_transaccion",key:"id"}},id_cuenta:{type:H.Sequelize.INTEGER,allowNull:!1,references:{model:"mnt_cuenta",key:"id"}},debe:{type:H.Sequelize.DECIMAL(10,2),allowNull:!1,defaultValue:0},haber:{type:H.Sequelize.DECIMAL(10,2),allowNull:!1,defaultValue:0}},{timestamps:!1,sequelize:U.connection(),tableName:"mnt_transaccion_cuenta"});const De=Ke;ye.associate(),ce.associate(),ee.associate(),ie.associate(),Z.associate(),fe.associate(),ge.associate(),be.associate(),we.associate(),Me.associate(),De.associate(),ke.associate(),Oe.associate(),Ne.associate(),Pe.associate(),je.associate(),Ie.associate();var Ce=function(e){x(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=E(t);if(r){var o=E(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return g(this,e)});function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"No autenticado";return o(this,i),n.call(this,"UNAUTHORIZED",_.HTTP_UNAUTHORIZED,e)}return a(i)}(k);const Le=require("uuid");var Be=function(){function e(){o(this,e)}var t,r;return a(e,null,[{key:"createToken",value:(r=O(R.mark((function e(t,r){return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){L.sign(t,r,{expiresIn:"60m"},(function(t,r){t?n(t):e(r)}))})));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)})},{key:"refresh_token",value:(t=O(R.mark((function e(t){var r,n;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,Le.v4)(),e.next=3,ce.create({refresh_token:r,id_usuario:t.id,valid:C().add("2","h").tz("America/El_Salvador").format()});case 3:return n=e.sent,e.abrupt("return",n.refresh_token);case 5:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}();var He=function(e){x(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=E(t);if(r){var o=E(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return g(this,e)});function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Recurso no encontrado";return o(this,i),n.call(this,"NOT_FOUND",_.HTTP_NOT_FOUND,e)}return a(i)}(k);const Ge=require("@babel/runtime/helpers/toConsumableArray"),Ue=require("nodemailer"),$e=require("mjml");var Fe=Ue.createTransport({host:process.env.MAIL_HOST,port:process.env.MAIL_PORT,secure:!1,auth:{user:process.env.MAIL_USER,pass:process.env.MAIL_PASS}}),Ve=function(){function e(){o(this,e)}var t;return a(e,null,[{key:"sendMail",value:(t=O(R.mark((function e(t){var r,n,o,a,i,s,u,c,l,p,d,f;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.email,n=t.header,o=t.subject,a=t.message,i=t.body,s=void 0===i?[]:i,u=t.sections,c=void 0===u?[]:u,l=$e({tagName:"mjml",attributes:{},children:[{tagName:"mj-body",attributes:{},children:[{tagName:"mj-section",attributes:{},children:[{tagName:"mj-column",attributes:{},children:[{tagName:"mj-image",attributes:{src:"https://next.salud.gob.sv/index.php/s/AHEMQ38JR93fnXQ/download",width:"350px"}}].concat(Ge(n),[{tagName:"mj-spacer",attributes:{"css-class":"primary"}},{tagName:"mj-divider",attributes:{"border-width":"3px","border-color":"#175efb"}},{tagName:"mj-text",attributes:{align:"center","font-weight":"bold","font-size":"12px"},content:a}],Ge(s))}]}].concat(Ge(c))}]}),p=l.html,e.next=4,Fe.verify();case 4:return d={from:"".concat("api-node-express"," <").concat(process.env.MAIL_USER,">"),to:r,subject:o,html:p},e.next=7,Fe.sendMail(d);case 7:return f=e.sent,e.abrupt("return",f);case 9:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}();var Ze=function(e){x(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=E(t);if(r){var o=E(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return g(this,e)});function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unprocessable Entity";return o(this,i),n.call(this,"UNPROCESSABLE_ENTITY",_.HTTP_UNPROCESSABLE_ENTITY,e)}return a(i)}(k),Qe=function(){function e(){o(this,e)}var t;return a(e,null,[{key:"roles",value:(t=O(R.mark((function e(t){var r,n,o,a,i=arguments;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>1&&void 0!==i[1]?i[1]:"name",e.next=3,ye.findOne({include:[ie,{model:ee,include:[ie]}],where:{id:t}});case 3:return n=e.sent,o=n.Perfils.reduce((function(e,t){return Ge(t.Rols)}),[]),a=new Set(n.Rols.concat(o).map((function(e){return e[r]}))),e.abrupt("return",Ge(a));case 7:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}(),Ye=function(){function e(){o(this,e)}var t,r,n;return a(e,null,[{key:"isGranted",value:(n=O(R.mark((function e(t,r){var n,o;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Qe.roles(t);case 2:return n=e.sent,e.next=5,n.some((function(e){return e===r}));case 5:return o=e.sent,e.abrupt("return",o);case 7:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"generateTwoFactorAuthCode",value:(r=O(R.mark((function e(t){var r;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.generateSecret({name:"".concat("api-node-express"," ").concat(t),issuer:"api-node-express"});case 2:return r=e.sent,e.abrupt("return",{secret_code:r.base32,qrCode:r.otpauth_url});case 4:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"verifyTwoFactorAuthCode",value:(t=O(R.mark((function e(t){var r,n,o,a,i;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.code,n=t.secretKey,o=t.time,a=t.step,i={secret:n,encoding:"base32",token:r},o&&(i.window=Number(o),i.step=a||10),e.abrupt("return",B.totp.verify(i));case 4:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}();var Je=function(e){x(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=E(t);if(r){var o=E(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return g(this,e)});function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Valores no válidos";return o(this,i),n.call(this,"BAD_REQUEST",_.HTTP_BAD_REQUEST,e)}return a(i)}(k),We=function(){function e(){o(this,e)}var t,r,n,i,s,u,c,l,p,d,f,m;return a(e,null,[{key:"twoFactorList",value:(m=O(R.mark((function e(t,r){var n;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fe.findAll();case 2:n=e.sent,r.status(_.HTTP_OK).json(n);case 4:case"end":return e.stop()}}),e)}))),function(e,t){return m.apply(this,arguments)})},{key:"confirmUser",value:(f=O(R.mark((function e(t,r){var n,o,a;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=t.params.token)){e.next=10;break}if(o=L.verify(n,"clave_secreta"),!(a=o.idUsuario)){e.next=9;break}return e.next=6,ye.update({is_suspended:!1,last_login:C().tz("America/El_Salvador").format(),verified:!0},{where:{id:a}});case 6:r.status(_.HTTP_OK).send({message:"El usuario ha sido verificado con exito"}),e.next=10;break;case 9:throw Je("El id de usuario es requerido");case 10:case"end":return e.stop()}}),e)}))),function(e,t){return f.apply(this,arguments)})},{key:"login",value:(d=O(R.mark((function t(r,n){var o,a,i,s,u,c,l,p,d,f,m,h,y,v;return R.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=r.body,a=o.email,i=o.password,t.next=3,ye.findOne({where:{email:a},attributes:["id","email","password","is_suspended","last_login","verified","two_factor_status","nombre"],include:[{model:fe,attributes:["id","nombre","icono"],through:{attributes:["is_primary","id"]}}]});case 3:if(s=t.sent){t.next=6;break}throw new Ce("Credenciales no validas");case 6:if(!"http://localhost:8080||http://localhost:8081".split("||").includes(r.headers.origin)){t.next=12;break}return t.next=10,Ye.isGranted(s.id,"ROLE_USER_ADMIN");case 10:if(t.sent){t.next=12;break}throw new Ce;case 12:if(D.compareSync(i,s.password)){t.next=15;break}throw new Ce("Credenciales no validas");case 15:if(s.verified){t.next=25;break}return u=s.id,t.next=19,Be.createToken({idUsuario:u},"clave_secreta");case 19:return c=t.sent,l=[{tagName:"mj-button",attributes:{width:"80%",padding:"5px 10px","font-size":"20px","background-color":"#175efb","border-radius":"99px"},content:"Hola ".concat(s.email)}],p=[{tagName:"mj-button",attributes:{width:"80%",padding:"5px 10px","font-size":"20px","background-color":"#175efb",href:"".concat("https://google.com","/verify-mail/").concat(c)},content:"VERIFICAR MI CUENTA"}],t.next=24,Ve.sendMail({email:s.email,header:l,subject:"Verificacion de correo electronico",message:"Para verificar tu cuenta debes de hacer click en el siguiente enlace:",body:p});case 24:return t.abrupt("return",n.status(_.HTTP_OK).json({message:"Por favor verificar la cuenta por medio del correo que se le ha enviado"}));case 25:if(!s.is_suspended){t.next=27;break}throw new Ce("El usuario se encuentra suspendido");case 27:return t.next=29,s.update({last_login:C().tz("America/El_Salvador").format()});case 29:return d=s.MetodoAutenticacions.map((function(e){return{nombre:e.nombre,descripcion:e.descripcion,icono:e.icono,id:e.id,is_primary:e.MetodoAutenticacionUsuario.is_primary,id_metodo_usuario:e.MetodoAutenticacionUsuario.id}})),f=d.find((function(e){return e.is_primary})),t.next=33,Qe.roles(s.id);case 33:if(m=t.sent,h={id:s.id,email:s.email,last_login:s.last_login,two_factor_status:s.two_factor_status,auth_methods:d,nombre:s.nombre},y={},v={user:h},s.two_factor_status){t.next=42;break}return v.roles=m,t.next=41,Be.refresh_token(s);case 41:y.refreshToken=t.sent;case 42:return t.next=44,Be.createToken(v,s.two_factor_status?"clave":"clave_secreta");case 44:if(y.token=t.sent,1!==(null==f?void 0:f.id)||!s.two_factor_status){t.next=48;break}return t.next=48,e.sendEmailCode(s,f.id);case 48:return t.abrupt("return",n.status(_.HTTP_OK).json(y));case 49:case"end":return t.stop()}}),t)}))),function(e,t){return d.apply(this,arguments)})},{key:"sendCode",value:(p=O(R.mark((function t(r,n){var o,a;return R.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=r.usuario.email,t.next=3,ye.findOne({where:{email:o}});case 3:return a=t.sent,t.next=6,e.sendEmailCode(a,1);case 6:return t.abrupt("return",n.status(_.HTTP_OK).json({message:"Se ha enviado el codigo a su correo electrónico"}));case 7:case"end":return t.stop()}}),t)}))),function(e,t){return p.apply(this,arguments)})},{key:"sendEmailCode",value:(l=O(R.mark((function e(t,r){var n,o,a,i;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pe.findOne({where:{id_usuario:t.id,id_metodo:r},attributes:["secret_key"]});case 2:return n=e.sent,o=n.secret_key,a=B.totp({secret:o,encoding:"base32",window:Number(process.env.TIME_BASED_TOKEN_2FA),step:10}),i=[{tagName:"mj-button",attributes:{width:"80%",padding:"5px 10px","font-size":"20px","background-color":"#175efb","border-radius":"99px"},content:"El codigo de verificacion es:"}],e.next=8,Ve.sendMail({email:t.email,header:i,subject:"Codigo de verificacion de usuario",message:a});case 8:case"end":return e.stop()}}),e)}))),function(e,t){return l.apply(this,arguments)})},{key:"logout",value:(c=O(R.mark((function e(t,r){return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ye.update({token_valid_after:C().tz("America/El_Salvador").format(),two_factor_status:!1},{where:{id:t.usuario.id}});case 2:return e.abrupt("return",r.status(_.HTTP_OK).json());case 3:case"end":return e.stop()}}),e)}))),function(e,t){return c.apply(this,arguments)})},{key:"twoFactorAuthLoginChoose",value:(u=O(R.mark((function e(t,r,n){var o,a,i,s,u,c,l,p,d;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=t.body.id_metodo,a=t.headers.authorization,i=a&&a.replace("Bearer ","")){e.next=5;break}throw new Ce("No autenticado");case 5:return e.prev=5,s=L.verify(i,"clave"),u=s.user,e.next=9,pe.findOne({where:{id_usuario:u.id,id_metodo:o,verified:!0}});case 9:if(c=e.sent,1!==o){e.next=18;break}return l=B.generateSecret({length:52}).base32,e.next=14,c.update({secret_key:l});case 14:return p=B.totp({secret:l,encoding:"base32",window:Number(process.env.TIME_BASED_TOKEN_2FA),step:10}),d=[{tagName:"mj-button",attributes:{width:"80%",padding:"5px 10px","font-size":"20px","background-color":"#175efb","border-radius":"99px"},content:"El codigo de verificacion es:"}],e.next=18,Ve.sendMail({email:u.email,header:d,subject:"Codigo de verificacion de usuario",message:p});case 18:return e.abrupt("return",r.status(_.HTTP_OK).send({message:"Se ha enviado el codigo de verificacion a su correo electronico"}));case 21:return e.prev=21,e.t0=e.catch(5),e.abrupt("return",z.handlerError(e.t0,t,r,n));case 24:case"end":return e.stop()}}),e,null,[[5,21]])}))),function(e,t,r){return u.apply(this,arguments)})},{key:"verifyTwoFactorAuthCode",value:(s=O(R.mark((function e(t,r){var n,o,a,i,s,u,c,l,p,d;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body,o=n.code,a=n.id_method,i=t.usuario.id,e.next=4,ye.findByPk(i);case 4:return s=e.sent,e.next=7,pe.findOne({where:{id_usuario:s.id,id_metodo:a}});case 7:if(u=e.sent){e.next=10;break}throw new Ce("Metodo de autenticación no configurado");case 10:if(null!=u&&u.verified){e.next=12;break}throw new Ce("El metodo de autenticación no ha sido verificado");case 12:return c={code:o,secretKey:u.secret_key},1===u.id_metodo&&(c.time=process.env.TIME_BASED_TOKEN_2FA,c.step=10),e.next=16,Ye.verifyTwoFactorAuthCode(c);case 16:if(e.sent){e.next=19;break}throw new Ze("El codigo proporcionado no es valido");case 19:return e.next=21,s.update({two_factor_status:!0,last_login:C().tz("America/El_Salvador").format(),token_valid_after:C().subtract(5,"s").tz("America/El_Salvador").format()});case 21:return e.next=23,Qe.roles(s.id);case 23:return l=e.sent,e.next=26,Be.refresh_token(s);case 26:return p=e.sent,e.next=29,Be.createToken({id:s.id,roles:l,user:s,email:s.email},"clave_secreta");case 29:return d=e.sent,e.abrupt("return",r.status(_.HTTP_OK).send({token:d,refreshToken:p,"2fa":s.two_factor_status}));case 31:case"end":return e.stop()}}),e)}))),function(e,t){return s.apply(this,arguments)})},{key:"RefreshToken",value:(i=O(R.mark((function e(t,r){var n,o,a,i,s,u,c,l;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ce.findOne({where:{refresh_token:t.body.refresh_token},attributes:["id","valid"],include:[{model:ye,attributes:["id","email","last_login"]}]});case 2:if(n=e.sent){e.next=5;break}throw new Ce;case 5:return e.next=7,Qe.roles(n.Usuario.id);case 7:if(o=e.sent,a=C(n.valid).valueOf(),i=C().tz("America/El_Salvador").valueOf(),!(a<i)){e.next=12;break}throw new Ce("El refresh token porporcionado no es valido");case 12:return s=n.Usuario,u={id:s.id,email:s.email,last_login:s.last_login,two_factor_status:s.two_factor_status},e.next=16,Be.createToken({roles:o,user:u},"clave_secreta");case 16:return c=e.sent,e.next=19,Be.refresh_token(n.Usuario);case 19:return l=e.sent,e.next=22,n.update({valid:C().add("4","s").tz("America/El_Salvador").format()});case 22:return e.abrupt("return",r.status(_.HTTP_OK).json({token:c,refresh_token:l,user:n.Usuario}));case 23:case"end":return e.stop()}}),e)}))),function(e,t){return i.apply(this,arguments)})},{key:"resetPassword",value:(n=O(R.mark((function e(t,r){var n,o,a,i,s;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ye.findOne({where:{email:t.body.email,is_suspended:!1}});case 2:if(n=e.sent){e.next=5;break}throw new Ze("El parametro no es un correo valido");case 5:return e.next=7,Be.createToken({id:n.id,email:n.email},"clave_secreta");case 7:return o=e.sent,e.next=10,Be.refresh_token(n);case 10:return e.next=12,n.update({token_valid_after:C().tz("America/El_Salvador").format()},{where:{id:n.id}});case 12:return a="".concat("https://google.com","/reset-password/").concat(o),i=[{tagName:"mj-text",attributes:{align:"center","font-size":"30px","font-weight":"bold",color:"#175efb"},content:"Recuperación de Contraseña"},{tagName:"mj-spacer",attributes:{"css-class":"primary"}},{tagName:"mj-divider",attributes:{"border-width":"3px","border-color":"#175efb"}},{tagName:"mj-text",attributes:{align:"center","font-size":"18px"},children:[{tagName:"h3",content:"¿Una nueva contraseña?",children:[{tagName:"p",content:"Haz clic al siguiente boton y crea una nueva."}]}]}],s=[{tagName:"mj-column",attributes:{},children:[{tagName:"mj-button",attributes:{href:a,width:"80%",padding:"5px 10px","font-size":"20px","background-color":"#175efb","border-radius":"99px"},content:"Cambiar contraseña"},{tagName:"mj-text",attributes:{align:"justify"},children:[{tagName:"p",content:"Si no solicitaste el cambio de contraseña, ignora este correo. Tu contraseña continuará siendo la misma."}]}]}],e.next=17,Ve.sendMail({email:n.email,header:i,subject:"Restablecer Contraseña",sections:s});case 17:if(e.sent){e.next=19;break}throw new He("Error! Hubo un problema al enviar el correo, intente nuevamente.");case 19:return e.abrupt("return",r.status(_.HTTP_OK).json({message:"El correo ha sido enviado"}));case 20:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"changePassword",value:(r=O(R.mark((function e(t,r){var n,o,a,i,s,u,c,l;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.body,o=n.password,a=n.confirm_password,i=t.headers.authorization.split(" ")[1],s=D.genSaltSync(),o===a){e.next=5;break}throw new He("Error! Las contraseñas  no coinciden");case 5:return u=D.hashSync(o,s),c=L.verify(i,"clave_secreta"),l=c.id,e.next=9,ye.update({password:u,token_valid_after:C().tz("America/El_Salvador").format()},{where:{id:l}});case 9:return e.abrupt("return",r.status(_.HTTP_OK).json({message:"contraseña actualizada"}));case 10:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)})},{key:"sendVerificationToken",value:(t=O(R.mark((function e(t,r){var n,o,a,i,s,u;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body.email,e.next=3,ye.findOne({where:{email:n}});case 3:return o=e.sent,a=o.id,e.next=7,Be.createToken({idUsuario:a},"clave_secreta");case 7:return i=e.sent,s=[{tagName:"mj-button",attributes:{width:"80%",padding:"5px 10px","font-size":"20px","background-color":"#175efb","border-radius":"99px"},content:"Hola ".concat(o.email)}],u=[{tagName:"mj-button",attributes:{width:"80%",padding:"5px 10px","font-size":"20px","background-color":"#175efb",href:"".concat("https://google.com","/verificar/").concat(i)},content:"VERIFICAR MI CUENTA"}],e.next=12,Ve.sendMail({email:o.email,header:s,subject:"Verificación de correo electrónico",message:"Para verificar tu cuenta debes de hacer click en el siguiente enlace:",body:u});case 12:return e.abrupt("return",r.status(_.HTTP_BAD_REQUEST).json({message:"Se ha reenviado el correo con el token de verificación"}));case 13:case"end":return e.stop()}}),e)}))),function(e,r){return t.apply(this,arguments)})}]),e}();const Xe=require("moment");var et=function(){var e=O(R.mark((function e(t,r,n){var o,a,i,s,u,c,l;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,o=t.headers.authorization){e.next=4;break}throw new Ce;case 4:if(!((o=o.split(" ")).length<2)){e.next=7;break}throw new Ce;case 7:return a=o[1],i=L.verify(a,"clave_secreta"),s=i.user,u=i.iat,c=1e3*u,e.next=12,ye.findOne({where:{id:s.id,is_suspended:!1}});case 12:if(l=e.sent){e.next=15;break}throw new Ce;case 15:if(!"http://localhost:8080||http://localhost:8081".split("||").includes(t.headers.origin)){e.next=21;break}return e.next=19,Ye.isGranted(l.id,"ROLE_USER_ADMIN");case 19:if(e.sent){e.next=21;break}throw new Ce;case 21:if(!(Xe(l.token_valid_after).valueOf()>c)){e.next=24;break}throw new Ce;case 24:t.usuario=l,n(),e.next=31;break;case 28:e.prev=28,e.t0=e.catch(0),z.handlerError(e.t0,t,r,n);case 31:case"end":return e.stop()}}),e,null,[[0,28]])})));return function(t,r,n){return e.apply(this,arguments)}}();const tt=et;var rt=function(){var e=O(R.mark((function e(t,r,n){var o,a,i,s,u,c,l;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,o=t.headers.authorization){e.next=4;break}throw new Ce;case 4:return a=o.replace("Bearer ",""),i=L.verify(a,"clave"),s=i.user,u=i.iat,c=1e3*u,e.next=9,ye.findOne({where:{id:s.id,is_suspended:!1}});case 9:if(l=e.sent){e.next=12;break}throw new Ce;case 12:if(!(Xe(l.token_valid_after).valueOf()>c)){e.next=15;break}throw new Ce;case 15:t.usuario=l,n(),e.next=22;break;case 19:e.prev=19,e.t0=e.catch(0),z.handlerError(e.t0,t,r,n);case 22:case"end":return e.stop()}}),e,null,[[0,19]])})));return function(t,r,n){return e.apply(this,arguments)}}();const nt=rt,ot=function(e){return function(t,r,n){return e(t,r).catch((function(e){return n(e)}))}},at=require("@babel/runtime/helpers/slicedToArray"),it=require("qrcode");var st=function(){function e(){o(this,e)}var t,r,n,i;return a(e,null,[{key:"exist",value:(i=O(R.mark((function t(r,n){var o,a,i,s,u=arguments;return R.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=u.length>2&&void 0!==u[2]?u[2]:"Recurso no encontrado",a=u.length>3&&void 0!==u[3]?u[3]:{},i=e.isValid(n),t.next=5,r.findByPk(i,a);case 5:if(s=t.sent){t.next=8;break}throw new He(o);case 8:return t.abrupt("return",s);case 9:case"end":return t.stop()}}),t)}))),function(e,t){return i.apply(this,arguments)})},{key:"isValid",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Unprocessable Entity by text";if(!(/^\d+$/.test(String(e))&&e>0))throw new Ze(t);return Number.parseInt(e,10)}},{key:"unique",value:(n=O(R.mark((function e(t,r){var n,o,a=arguments;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>2&&void 0!==a[2]?a[2]:"Debe ser un valor unico",e.next=3,t.findOne({where:r});case 3:if(!(o=e.sent)){e.next=6;break}throw new Je(n);case 6:return e.abrupt("return",o);case 7:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"existOrCreate",value:(r=O(R.mark((function e(t,r,n){var o,a,i=arguments;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=i.length>3&&void 0!==i[3]?i[3]:null,e.next=3,t.findOne(r);case 3:if(a=e.sent){e.next=14;break}if(null===o){e.next=11;break}return e.next=8,t.create(n,o);case 8:a=e.sent,e.next=14;break;case 11:return e.next=13,t.create(n);case 13:a=e.sent;case 14:return e.abrupt("return",a);case 15:case"end":return e.stop()}}),e)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"arrayExist",value:(t=O(R.mark((function e(t,r){var n,o,a,i=arguments;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=i.length>2&&void 0!==i[2]?i[2]:"id no existe",o=i.length>3&&void 0!==i[3]?i[3]:{},a=0;case 3:if(!(a<r.length)){e.next=9;break}return e.next=6,this.exist(t,r[a],n,o);case 6:a+=1,e.next=3;break;case 9:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})}]),e}();var ut=function(e){x(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=E(t);if(r){var o=E(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return g(this,e)});function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Accion denegada";return o(this,i),n.call(this,"FORBIDDEN",_.HTTP_FORBIDDEN,e)}return a(i)}(k);function ct(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function lt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ct(Object(r),!0).forEach((function(t){b(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ct(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var pt=function(){function e(){o(this,e)}var t,r,n,i,s,u,c,l,p,d,f;return a(e,null,[{key:"index",value:(f=O(R.mark((function e(t,r){var n,o,a,i,s,u,c,l,p,d,f,m,h,y;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.query,o=n.page,a=void 0===o?1:o,i=n.per_page,s=void 0===i?10:i,u=n.paginacion,c=void 0===u?"true":u,l=n.email,p=n.habilitado,d={},f={},"true"!==c){e.next=11;break}return e.next=6,st.isValid(s,"cantidad por pagina debe ser de tipo entero");case 6:return e.next=8,st.isValid(a,"pagina debe ser de tipo entero");case 8:f.offset=s*(a-1),f.limit=Number(s),f.distinct=!0;case 11:return l&&(d.email=b({},H.Op.iLike,"%".concat(l||"","%"))),p&&(d.is_suspended=!("true"===p)),e.next=15,ye.findAndCountAll(lt(lt({},f),{},{attributes:{exclude:["password","token_valid_after","two_factor_status"]},include:[ie,ee],order:["id"],where:d}));case 15:return m=e.sent,h=m.rows,y=m.count,"true"===c&&r.set({total_rows:Number(y),page:Number(a),per_page:Number(s)}),e.abrupt("return",r.status(_.HTTP_OK).json(h));case 20:case"end":return e.stop()}}),e)}))),function(e,t){return f.apply(this,arguments)})},{key:"store",value:(d=O(R.mark((function e(t,r){var n,o,a,i,s,u,c,l,p,d,f,m,h,y,v,b,w,x,g,E;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=U.connection(),e.next=3,n.transaction();case 3:return o=e.sent,a=t.body,i=a.perfiles,s=a.roles,u=a.email,c=a.password,l="false"===process.env.DISABLE_TWO_FACTOR_AUTH,p=D.genSaltSync(),d=D.hashSync(c,p),e.next=10,ye.findOne({where:{email:u}});case 10:if(!e.sent){e.next=13;break}throw new Ze("Correo electronico ya existe");case 13:if(e.prev=13,!i){e.next=25;break}h=0;case 16:if(!(h<i.length)){e.next=22;break}return e.next=19,st.exist(ee,i[h],"No se ha encontrado el perfil con id ".concat(i[h]));case 19:h++,e.next=16;break;case 22:return e.next=24,ee.findAll({where:{id:i}});case 24:m=e.sent;case 25:if(!s){e.next=36;break}y=0;case 27:if(!(y<s.length)){e.next=33;break}return e.next=30,st.exist(ie,s[y],"No se ha encontrado el rol con id ".concat(s[y]));case 30:y++,e.next=27;break;case 33:return e.next=35,ie.findAll({where:{id:s}});case 35:f=e.sent;case 36:return e.next=38,ye.create({email:u,password:d,is_suspended:l,two_factor_status:!1},{transaction:o});case 38:return v=e.sent,e.next=41,v.addPerfils(i,{transaction:o});case 41:return e.next=43,v.addRols(s,{transaction:o});case 43:return b=v.id,e.next=46,Ye.generateTwoFactorAuthCode(v.email);case 46:return w=e.sent,e.next=49,pe.create({id_usuario:v.id,id_metodo:1,is_primary:!0,secret_key:w.secret_code,verified:!0},{transaction:o});case 49:return e.next=51,Be.createToken({idUsuario:b},"clave_secreta");case 51:return x=e.sent,g=[{tagName:"mj-button",attributes:{width:"80%",padding:"5px 10px","font-size":"20px","background-color":"#175efb","border-radius":"99px"},content:"Hola ".concat(v.email)}],E=[{tagName:"mj-button",attributes:{width:"80%",padding:"5px 10px","font-size":"20px","background-color":"#175efb",href:"".concat("https://google.com","/verificar/").concat(x)},content:"VERIFICAR MI CUENTA"}],e.next=56,Ve.sendMail({email:v.email,header:g,subject:"Verificacion de correo electronico",message:"Para verificar tu cuenta debes de hacer click en el siguiente enlace:",body:E});case 56:return e.next=58,o.commit();case 58:return e.abrupt("return",r.status(_.HTTP_CREATED).json({id:v.id,email:v.email,perfiles:m,roles:f}));case 61:return e.prev=61,e.t0=e.catch(13),e.next=65,o.rollback();case 65:throw e.t0;case 66:case"end":return e.stop()}}),e,null,[[13,61]])}))),function(e,t){return d.apply(this,arguments)})},{key:"update",value:(p=O(R.mark((function e(t,r){var n,o,a,i,s,u,c,l;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body,o=n.email,a=n.roles,i=void 0===a?[]:a,s=n.perfiles,u=void 0===s?[]:s,c={},null!==o&&""!==o&&(c.email=o),e.next=5,st.exist(ye,t.params.id,"No se ha encontrado el usuario con id ".concat(t.params.id));case 5:return(l=e.sent).update(c,{where:{id:t.params.id},returning:["id","email","is_suspended"]}),e.next=9,l.setRols(i);case 9:return e.next=11,l.setPerfils(u);case 11:return e.abrupt("return",r.status(_.HTTP_OK).json(l));case 12:case"end":return e.stop()}}),e)}))),function(e,t){return p.apply(this,arguments)})},{key:"destroy",value:(l=O(R.mark((function e(t,r){var n,o;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.id,e.next=3,st.exist(ye,n,"No se ha encontrado el usuario con id ".concat(n));case 3:return o=e.sent,e.next=6,o.update({is_suspended:!o.is_suspended});case 6:return e.abrupt("return",r.status(_.HTTP_OK).json({message:o.is_suspended?"Usuario deshabilitado":"Usuario habilitado"}));case 7:case"end":return e.stop()}}),e)}))),function(e,t){return l.apply(this,arguments)})},{key:"show",value:(c=O(R.mark((function e(t,r){var n,o;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.id,e.next=3,st.exist(ye,n,"No se ha encontrado el usuario con id ".concat(n),{include:[{model:ee,through:{attributes:[]}},{model:ie,through:{attributes:[]}}]});case 3:o=e.sent,r.status(_.HTTP_OK).json(o);case 5:case"end":return e.stop()}}),e)}))),function(e,t){return c.apply(this,arguments)})},{key:"updatePassword",value:(u=O(R.mark((function e(t,r){var n,o,a,i,s,u,c,l,p,d;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.body,o=n.password_actual,a=n.password,i=n.confirm_password,D.compareSync(o,t.usuario.password)){e.next=3;break}throw new ut("La contraseña proporcionada no es correcta");case 3:if(o!==a){e.next=5;break}throw new He("La nueva contraseña no puede ser igual que la anterior");case 5:if(a===i){e.next=7;break}throw new Je("Las contraseñas no coinciden");case 7:return s=D.genSaltSync(),u=D.hashSync(a,s),e.next=11,ye.update({password:u,token_valid_after:C().subtract(5,"s").tz("America/El_Salvador").format()},{where:{id:t.usuario.id}});case 11:return c=[],e.next=14,Ve.sendMail({email:t.usuario.email,header:c,subject:"Cambio de contraseña",message:"Constraseña modificada"});case 14:return e.next=16,Be.refresh_token(t.usuario);case 16:return l=e.sent,e.next=19,Qe.roles(t.usuario.id);case 19:return p=e.sent,e.next=22,Be.createToken({roles:p,user:t.usuario},"clave_secreta");case 22:return d=e.sent,e.abrupt("return",r.status(_.HTTP_OK).json({message:"Contraseña actualizada con exito",token:d,refreshToken:l}));case 24:case"end":return e.stop()}}),e)}))),function(e,t){return u.apply(this,arguments)})},{key:"updateEmail",value:(s=O(R.mark((function e(t,r){var n,o,a,i,s,u,c,l;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.body,o=n.email,a=n.password,o!==t.usuario.email){e.next=3;break}throw new Ze("El correo no puede ser igual al anterior");case 3:if(D.compareSync(a,t.usuario.password)){e.next=5;break}throw new Je("La contraseña proporcionada no es correcta");case 5:return e.next=7,ye.findOne({where:{email:o}});case 7:if(!e.sent){e.next=10;break}throw new He("El correo ya se encuentra en uso");case 10:return i="\n      Estimado usuario se le comunica que el correo: ".concat(t.usuario.email,"\n        ha sido cambiado satisfactoriamente.\n        Desde este momento ").concat(o,"\n    manejará la cuenta en donde solicito el cambio"),e.next=13,Ve.sendMail({email:o,header:[],message:i,subject:"Cambio de email"});case 13:return e.next=15,ye.findOne({where:{id:t.usuario.id},attributes:["id","email","last_login","two_factor_status"]});case 15:return s=e.sent,e.next=18,s.update({email:o,token_valid_after:C().tz("America/El_Salvador").format()},{returning:!0});case 18:return e.next=20,Be.refresh_token(t.usuario);case 20:return u=e.sent,e.next=23,Qe.roles(t.usuario.id);case 23:return c=e.sent,e.next=26,Be.createToken({roles:c,user:s},"clave_secreta");case 26:return l=e.sent,e.abrupt("return",r.status(_.HTTP_OK).json({message:"Correo electronico actualizado con exito",token:l,refreshToken:u}));case 28:case"end":return e.stop()}}),e)}))),function(e,t){return s.apply(this,arguments)})},{key:"storeMethodUser",value:(i=O(R.mark((function e(t,r){var n,o,a,i,s,u,c,l;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body.id_method,e.next=3,Ye.generateTwoFactorAuthCode(t.usuario.email);case 3:return o=e.sent,a={is_primary:!1,temporal_key:o.secret_code,verified:!1},e.next=7,pe.findOrCreate({where:{id_usuario:t.usuario.id,id_metodo:n},defaults:a});case 7:if(i=e.sent,s=at(i,2),u=s[0],s[1]){e.next=14;break}return e.next=14,u.update({temporal_key:o.secret_code});case 14:if(2!==Number(n)){e.next=21;break}return e.t0=r.status(_.HTTP_OK),e.next=18,(0,it.toDataURL)(o.qrCode);case 18:return e.t1=e.sent,e.t2={message:"Favor valide el nuevo metodo de autenticacion, escanee el codigo qr",codigoQr:e.t1},e.abrupt("return",e.t0.send.call(e.t0,e.t2));case 21:return c=B.totp({secret:u.temporal_key,encoding:"base32",window:Number(process.env.TIME_BASED_TOKEN_2FA),step:10}),l=[{tagName:"mj-button",attributes:{width:"80%",padding:"5px 10px","font-size":"20px","background-color":"#175efb","border-radius":"99px"},content:"El codigo de verificacion es:"}],e.next=25,Ve.sendMail({email:t.usuario.email,header:l,subject:"Codigo de verificación de usuario",message:c});case 25:return e.abrupt("return",r.status(_.HTTP_OK).send({message:"Favor valide el nuevo metodo de autenticación, revise su correo electrónico"}));case 26:case"end":return e.stop()}}),e)}))),function(e,t){return i.apply(this,arguments)})},{key:"authMethodVerification",value:(n=O(R.mark((function e(t,r){var n,o,a,i,s,u;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body,o=n.id_method,a=n.code,e.next=3,pe.findOne({where:{id_usuario:t.usuario.id,id_metodo:o}});case 3:if(i=e.sent){e.next=6;break}throw new He("El usuario no tiene este metodo de autenticacion asociado");case 6:return s={code:a,secretKey:i.temporal_key},1===Number(o)&&(s.time=process.env.TIME_BASED_TOKEN_2FA),e.next=10,Ye.verifyTwoFactorAuthCode(s);case 10:if(e.sent){e.next=13;break}throw new Ze("El codigo proporcionado no es valido");case 13:return e.next=15,i.update({secret_key:i.temporal_key,verified:!0});case 15:return u=[{tagName:"mj-text",attributes:{width:"80%",padding:"5px 10px","font-size":"20px","background-color":"#175efb","border-radius":"99px"},content:"Se ha cambiado el metodo de autenticación"}],e.next=18,Ve.sendMail({email:t.usuario.email,subject:"Metodo de autenticacion cambiado.",header:u});case 18:return e.abrupt("return",r.status(_.HTTP_OK).send({message:"Se ha modificado el metodo de autenticación con exito!"}));case 19:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"updatePrimaryMethod",value:(r=O(R.mark((function e(t,r){var n,o,a,i;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.id_method,o=t.usuario.id,e.next=4,pe.findOne({where:{id_usuario:o,id_metodo:n}});case 4:if(null!=(a=e.sent)&&a.verified){e.next=7;break}throw new Ze("No es posible seleccionar este método de autenticación debido a que no esta verificado");case 7:return e.next=9,pe.update({is_primary:!1},{where:{id:b({},H.Op.not,a.id),id_usuario:t.usuario.id}});case 9:return e.next=11,a.update({is_primary:!0});case 11:return i=[{tagName:"mj-text",attributes:{width:"80%",padding:"5px 10px","font-size":"20px","background-color":"#175efb","border-radius":"99px"},content:"Se ha cambiado el método de autenticación primario"}],e.next=14,Ve.sendMail({email:t.usuario.email,subject:"Alerta de actualización de cuenta.",header:i});case 14:return e.abrupt("return",r.status(_.HTTP_OK).send({message:"Solicitud procesada con exito!"}));case 15:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)})},{key:"getMetodosUsuario",value:(t=O(R.mark((function e(t,r){var n;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fe.findAll({include:[{model:pe,required:!1,where:{id_usuario:t.usuario.id}}]});case 2:return n=e.sent,e.abrupt("return",r.status(_.HTTP_OK).json(n));case 4:case"end":return e.stop()}}),e)}))),function(e,r){return t.apply(this,arguments)})}]),e}();const dt=function(e){return function(){var t=O(R.mark((function t(r,n,o){return R.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Ye.isGranted(r.usuario.id,e);case 2:t.sent?o():z.handlerError(new ut,r,n,o);case 4:case"end":return t.stop()}}),t)})));return function(e,r,n){return t.apply(this,arguments)}}()};var ft=(0,l.Router)();ft.get("/2fa/method",[dt("ROLE_USER_AUTH_METHOD_LIST")],ot(pt.getMetodosUsuario)),ft.get("/",[dt("ROLE_USER_LIST")],ot(pt.index)),ft.post("/",[dt("ROLE_USER_CREATE"),K({$id:"http://example.com/schemas/usuarioCreateSchema.json#",type:"object",properties:{password:{$ref:"defs.json#/definitions/password"},email:{$ref:"defs.json#/definitions/email"},perfiles:{$ref:"defs.json#/definitions/arrayIntUnico"},roles:{$ref:"defs.json#/definitions/arrayIntUnico"}},anyOf:[{required:["roles"],errorMessage:{required:"Debe poseer un rol o un pefil"}},{required:["perfiles"],errorMessage:{required:"Debe poseer un rol o un pefil"}}],required:["password","email"],errorMessage:{required:{password:"El campo de contraseña del usuario es requerido",email:"El campo de email del usuario es requerido"},properties:{perfiles:"El campo perfiles debe de ser un array de valores unicos y tipo numerico",roles:"El campo roles debe de ser un array de valores unicos y tipo numerico"}}})],ot(pt.store)),ft.get("/:id",[dt("ROLE_USER_LIST")],ot(pt.show)),ft.put("/:id",[dt("ROLE_USER_UPDATE"),K({$id:"http://example.com/schemas/usuarioUpdateSchema.json#",type:"object",properties:{email:{$ref:"defs.json#/definitions/email"},perfiles:{$ref:"defs.json#/definitions/arrayIntUnico"},roles:{$ref:"defs.json#/definitions/arrayIntUnico"}},anyOf:[{required:["roles"],errorMessage:{required:"Debe poseer un rol o un pefil"}},{required:["perfiles"],errorMessage:{required:"Debe poseer un rol o un pefil"}}],required:["email"],errorMessage:{required:{email:"El campo de email del usuario es requerido"},properties:{perfiles:"El campo perfiles debe de ser un array de valores unicos y tipo numerico",roles:"El campo roles debe de ser un array de valores unicos y tipo numerico"}}})],ot(pt.update)),ft.delete("/:id",[dt("ROLE_USER_DELETE")],ot(pt.destroy)),ft.put("/update/password",[K({$id:"http://example.com/schemas/usuarioPasswordUpdate.json#",type:"object",properties:{password_actual:{$ref:"defs.json#/definitions/string"},password:{$ref:"defs.json#/definitions/password"},confirm_password:{$ref:"defs.json#/definitions/password"}},required:["password_actual","password","confirm_password"],errorMessage:{required:{password_actual:"La contraseña actual es requerida",password:"Debe proporcionar una nueva contraseña",confirm_password:"Debe confirmar la contraseña"}}})],ot(pt.updatePassword)),ft.put("/update/email",[K({$id:"http://example.com/schemas/usuarioUpdateEmailSchema.json#",type:"object",properties:{email:{$ref:"defs.json#/definitions/email"},password:{$ref:"defs.json#/definitions/string"}},required:["email","password"],errorMessage:{required:{email:"El campo email de la ruta es requerido",password:"El campo password de la ruta es requerido"}}})],ot(pt.updateEmail)),ft.post("/2fa/method",ot(pt.storeMethodUser)),ft.post("/2fa/method/verify",ot(pt.authMethodVerification)),ft.put("/2fa/method/:id_method",ot(pt.updatePrimaryMethod));const mt=ft;function ht(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function yt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ht(Object(r),!0).forEach((function(t){b(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ht(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var vt=function(){function e(){o(this,e)}var t,r,n,i,s;return a(e,null,[{key:"index",value:(s=O(R.mark((function e(t,r){var n,o,a,i,s,u,c,l,p,d,f,m,h;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.query,o=n.page,a=void 0===o?1:o,i=n.per_page,s=void 0===i?10:i,u=n.paginacion,c=void 0===u?"true":u,l=n.nombre,p={},d={},"true"!==c){e.next=11;break}return e.next=6,st.isValid(s,"cantidad por pagina debe ser de tipo entero");case 6:return e.next=8,st.isValid(a,"pagina debe ser de tipo entero");case 8:d.offset=s*(a-1),d.limit=Number(s),d.distinct=!0;case 11:return l&&(p.name=b({},H.Op.iLike,"%".concat(l,"%"))),e.next=14,ie.findAndCountAll(yt({include:[oe],where:p},d));case 14:return f=e.sent,m=f.count,h=f.rows,"true"===c&&r.set({total_rows:Number(m),page:Number(a),per_page:Number(s)}),e.abrupt("return",r.status(_.HTTP_OK).json(h));case 19:case"end":return e.stop()}}),e)}))),function(e,t){return s.apply(this,arguments)})},{key:"store",value:(i=O(R.mark((function e(t,r){var n,o,a,i;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body,o=n.name,a=n.id_tipo_rol,e.next=3,ie.findOne({where:{name:o.trim().toUpperCase()}});case 3:if(!e.sent){e.next=6;break}throw new Ze("Role ya existe");case 6:return e.next=8,ie.create({name:o.trim().toUpperCase(),id_tipo_rol:a});case 8:return i=e.sent,e.abrupt("return",r.status(_.HTTP_CREATED).json(i));case 10:case"end":return e.stop()}}),e)}))),function(e,t){return i.apply(this,arguments)})},{key:"show",value:(n=O(R.mark((function e(t,r){var n,o;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.id,e.next=3,st.exist(ie,n,"El rol no ha sido encontrado");case 3:return o=e.sent,e.abrupt("return",r.status(_.HTTP_OK).json(o));case 5:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"update",value:(r=O(R.mark((function e(t,r){var n,o,a,i,s;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body,o=n.name,a=n.id_tipo_rol,i=t.params.id,e.next=4,st.exist(ie,i,"El rol no ha sido encontrado");case 4:return e.next=6,ie.update({name:o,id_tipo_rol:a},{where:{id:i},returning:["name","id_tipo_rol"]});case 6:return s=e.sent,e.abrupt("return",r.status(_.HTTP_OK).json(s[1]));case 8:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)})},{key:"destroy",value:(t=O(R.mark((function e(t,r){var n,o;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.id,e.next=3,st.exist(ie,n,"El rol no ha sido encontrado");case 3:return o=e.sent,e.next=6,o.destroy();case 6:return e.abrupt("return",r.status(_.HTTP_OK).json({message:"Rol eliminado"}));case 7:case"end":return e.stop()}}),e)}))),function(e,r){return t.apply(this,arguments)})}]),e}();const bt={$id:"http://example.com/schemas/rolCreateSchema.json#",type:"object",properties:{id_tipo_rol:{$ref:"defs.json#/definitions/integer"}},required:["id_tipo_rol"],errorMessage:{properties:{id_tipo_rol:"El campo id_tipo_rol debe ser de tipo numérico"}},allOf:[{if:{properties:{id_tipo_rol:{const:1}}},then:{properties:{name:{type:"string",pattern:"^(ROLE_)+[A-Z_]*",errorMessage:{type:"el name debe ser de tipo alfanumerico",pattern:"el name debe tener el prefijo ROLE_"}}}}},{if:{properties:{id_tipo_rol:{const:2}}},then:{properties:{name:{type:"string",pattern:"^(ROLE_ADMIN_)+[A-Z_]*",errorMessage:{type:"el name debe ser de tipo alfanumerico",pattern:"el name debe tener el prefijo ROLE_ADMIN_"}}}}},{if:{properties:{id_tipo_rol:{const:3}}},then:{properties:{name:{type:"string",pattern:"^(ROLE_FRONT_)+[A-Z_]*",errorMessage:{type:"el name debe ser de tipo alfanumerico",pattern:"el name debe tener el prefijo ROLE_FRONT_"}}}}}]};var _t=(0,l.Router)();_t.get("/",[dt("ROLE_ROLE_LIST")],ot(vt.index)),_t.post("/",[K(bt),dt("ROLE_ROLE_CREATE")],ot(vt.store)),_t.get("/:id",[dt("ROLE_ROLE_LIST")],ot(vt.show)),_t.put("/:id",[K(bt),dt("ROLE_ROLE_UPDATE")],ot(vt.update)),_t.delete("/:id",[dt("ROLE_ROLE_DELETE")],ot(vt.destroy));const wt=_t;var xt=function(){function e(){o(this,e)}var t;return a(e,null,[{key:"index",value:(t=O(R.mark((function e(t,r){var n;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,oe.findAll();case 2:return n=e.sent,e.abrupt("return",r.status(_.HTTP_OK).json(n));case 4:case"end":return e.stop()}}),e)}))),function(e,r){return t.apply(this,arguments)})}]),e}(),gt=(0,l.Router)();gt.get("/",[],ot(xt.index));const Et=gt;function kt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Tt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?kt(Object(r),!0).forEach((function(t){b(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):kt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Ot=function(){function e(){o(this,e)}var t,r,n,i;return a(e,null,[{key:"index",value:(i=O(R.mark((function e(t,r){var n,o,a,i,s,u,c,l,p,d,f,m,h,y;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.query,o=n.page,a=void 0===o?1:o,i=n.per_page,s=void 0===i?10:i,u=n.paginacion,c=void 0===u?"true":u,l=n.nombre,p=n.codigo,d={},f={},"true"!==c){e.next=11;break}return e.next=6,st.isValid(s,"cantidad por pagina debe ser de tipo entero");case 6:return e.next=8,st.isValid(a,"pagina debe ser de tipo entero");case 8:f.offset=s*(a-1),f.limit=Number(s),f.distinct=!0;case 11:return l&&(d.nombre=b({},H.Op.iLike,"%".concat(l,"%"))),p&&(d.codigo=b({},H.Op.iLike,"%".concat(p,"%"))),e.next=15,ee.findAndCountAll(Tt({include:[{model:ie,required:!0}],where:d},f));case 15:return m=e.sent,h=m.count,y=m.rows,"true"===c&&r.set({total_rows:Number(h),page:Number(a),per_page:Number(s)}),e.abrupt("return",r.status(_.HTTP_OK).json(y));case 20:case"end":return e.stop()}}),e)}))),function(e,t){return i.apply(this,arguments)})},{key:"store",value:(n=O(R.mark((function e(t,r){var n,o,a,i,s,u;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body,o=n.nombre,a=n.codigo,i=n.roles,e.next=3,U.connection().transaction();case 3:return s=e.sent,e.prev=4,e.next=7,ee.create({nombre:o,codigo:a},{transaction:s});case 7:return u=e.sent,e.next=10,u.setRols(i,{transaction:s});case 10:return e.next=12,s.commit();case 12:return e.abrupt("return",r.status(_.HTTP_CREATED).json({id:u.id,nombre:o,codigo:a,roles:i}));case 15:return e.prev=15,e.t0=e.catch(4),e.next=19,s.rollback();case 19:throw e.t0;case 20:case"end":return e.stop()}}),e,null,[[4,15]])}))),function(e,t){return n.apply(this,arguments)})},{key:"show",value:(r=O(R.mark((function e(t,r){var n,o;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.id,e.next=3,st.exist(ee,n,"El perfil no ha sido encontrado",{include:{model:ie,through:{attributes:[]}}});case 3:return o=e.sent,e.abrupt("return",r.status(_.HTTP_OK).json(o));case 5:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)})},{key:"update",value:(t=O(R.mark((function e(t,r){var n,o,a,i,s,u,c;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body,o=n.nombre,a=n.codigo,i=n.roles,s=t.params.id,e.next=4,U.connection().transaction();case 4:return u=e.sent,e.prev=5,e.next=8,st.exist(ee,s,"Perfil no encontrado");case 8:return c=e.sent,e.next=11,c.update({nombre:o,codigo:a},{transaction:u});case 11:return e.next=13,c.setRols(i,{transaction:u});case 13:return e.next=15,u.commit();case 15:return e.abrupt("return",r.status(_.HTTP_OK).json(c));case 18:return e.prev=18,e.t0=e.catch(5),e.next=22,u.rollback();case 22:throw e.t0;case 23:case"end":return e.stop()}}),e,null,[[5,18]])}))),function(e,r){return t.apply(this,arguments)})}]),e}();var Rt=(0,l.Router)();Rt.get("/",[dt("ROLE_PROFILE_LIST")],ot(Ot.index)),Rt.post("/",[dt("ROLE_PROFILE_CREATE"),K({$id:"http://example.com/schemas/perfilCreateSchema.json#",type:"object",properties:{nombre:{$ref:"defs.json#/definitions/string"},codigo:{$ref:"defs.json#/definitions/codigo"},roles:{$ref:"defs.json#/definitions/arrayIntUnico"}},required:["nombre","codigo","roles"],errorMessage:{required:{nombre:"El nombre es requerido",codigo:"El código es requerido",roles:"El campo roles es requerido"},properties:{nombre:"el nombre debe ser de tipo alfanumerico",roles:"Los roles deber ser un array numerico"}}})],ot(Ot.store)),Rt.get("/:id",[dt("ROLE_PROFILE_LIST")],ot(Ot.show)),Rt.put("/:id",[dt("ROLE_PROFILE_UPDATE"),K({$id:"http://example.com/schemas/perfilUpdateSchema.json#",type:"object",properties:{nombre:{$ref:"defs.json#/definitions/string"},codigo:{$ref:"defs.json#/definitions/codigo"}},required:["nombre","codigo"],errorMessage:{required:{nombre:"El campo nombre es requerido",codigo:"El campo codigo es requerido"},properties:{nombre:"el nombre debe ser de tipo alfanumerico"}}})],ot(Ot.update));const Nt=Rt;var St;function jt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function qt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?jt(Object(r),!0).forEach((function(t){b(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Pt(e,t,r){return function(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}(e,t),r}function At(e){var t,r,n,o=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,n=Symbol.iterator);o--;){if(r&&null!=(t=e[r]))return t.call(e);if(n&&null!=(t=e[n]))return new It(t.call(e));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function It(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return It=function(e){this.s=e,this.n=e.next},It.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?Promise.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?Promise.reject(e):t(r.apply(this.s,arguments))}},new It(e)}var zt=function(){function e(){o(this,e)}var t,r,n,i,s;return a(e,null,[{key:"index",value:(s=O(R.mark((function e(t,r){var n,o,a,i,s,u,c,l,p,d,f,m,h,y;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.query,o=n.page,a=void 0===o?1:o,i=n.per_page,s=void 0===i?10:i,u=n.paginacion,c=void 0===u?"true":u,l=n.nombre,p=n.uri,d={},f={},"true"!==c){e.next=11;break}return e.next=6,st.isValid(s,"cantidad por pagina debe ser de tipo entero");case 6:return e.next=8,st.isValid(a,"pagina debe ser de tipo entero");case 8:f.offset=s*(a-1),f.limit=Number(s),f.distinct=!0;case 11:return l&&(d.nombre=b({},H.Op.iLike,"%".concat(l,"%"))),p&&(d.uri=b({},H.Op.iLike,"%".concat(p,"%"))),e.next=15,Z.findAndCountAll(qt({include:[ie],where:d},f));case 15:return m=e.sent,h=m.count,y=m.rows,"true"===c&&r.set({total_rows:Number(h),page:Number(a),per_page:Number(s)}),e.abrupt("return",r.status(_.HTTP_OK).json(y));case 20:case"end":return e.stop()}}),e)}))),function(e,t){return s.apply(this,arguments)})},{key:"store",value:(i=O(R.mark((function e(t,r){var n,o,a,i,s,u,c,l,p,d,f,m,h,y,v,b,w,x;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=U.connection(),e.next=3,n.transaction();case 3:if(o=e.sent,a=t.body,i=a.nombre,s=a.uri,u=a.nombre_uri,c=a.mostrar,l=a.icono,p=a.orden,d=a.admin,f=a.publico,m=a.id_ruta_padre,h=a.roles,e.prev=5,!h){e.next=14;break}y=0;case 8:if(!(y<h.length)){e.next=14;break}return e.next=11,st.exist(ie,h[y],"No se encontró el rol con id ".concat(h[y]));case 11:y++,e.next=8;break;case 14:return e.next=16,Z.create({nombre:i,uri:s,nombre_uri:u,mostrar:c,icono:l,orden:p,admin:d,publico:f,id_ruta_padre:m},{transaction:o});case 16:return v=e.sent,e.next=19,v.addRols(h,{transaction:o});case 19:return e.next=21,o.commit();case 21:return b=v.id,e.next=24,Z.getById(b,{include:[{model:ie}]});case 24:return w=e.sent,x=w.Rols,e.abrupt("return",r.status(_.HTTP_CREATED).json({id:v.id,nombre:v.nombre,nombre_uri:v.nombre_uri,mostrar:v.mostrar,icono:v.icono,orden:v.orden,admin:v.admin,publico:v.publico,id_ruta_padre:v.id_ruta_padre,roles:x}));case 29:return e.prev=29,e.t0=e.catch(5),e.next=33,o.rollback();case 33:throw e.t0;case 34:case"end":return e.stop()}}),e,null,[[5,29]])}))),function(e,t){return i.apply(this,arguments)})},{key:"show",value:(n=O(R.mark((function e(t,r){var n,o;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.id,e.next=3,st.exist(Z,n,"No se encontró una ruta con id ".concat(n),{include:{model:ie,attributes:["id","name"]}});case 3:return o=e.sent,e.abrupt("return",r.status(_.HTTP_OK).json(o.dataValues));case 5:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"update",value:(r=O(R.mark((function e(t,r){var n,o,a,i,s,u,c,l,p,d,f,m,h;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body,o=n.nombre,a=n.uri,i=n.nombre_uri,s=n.mostrar,u=n.icono,c=n.orden,l=n.admin,p=n.publico,d=n.id_ruta_padre,f=n.roles,m=t.params.id,e.next=4,st.exist(Z,m,"No se encontró una ruta con id ".concat(m));case 4:return h=e.sent,e.next=7,h.update({nombre:o,uri:a,nombre_uri:i,mostrar:s,icono:u,orden:c,admin:l,publico:p,id_ruta_padre:d});case 7:return e.next=9,h.setRols(f);case 9:return e.abrupt("return",r.status(_.HTTP_OK).json({message:"Datos actualizados con exito"}));case 10:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)})},{key:"getRutas",value:(t=O(R.mark((function t(r,n){var o,a;return R.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o="http://localhost:8080||http://localhost:8081".split("||"),t.next=3,Pt(e,e,Mt).call(e,r.usuario.id,o.includes(r.headers.origin));case 3:return a=t.sent,t.abrupt("return",n.status(_.HTTP_OK).json(a));case 5:case"end":return t.stop()}}),t)}))),function(e,r){return t.apply(this,arguments)})}]),e}();function Mt(e,t){return Kt.apply(this,arguments)}function Kt(){return(Kt=O(R.mark((function e(t,r){var n,o,a;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Qe.roles(t,"id");case 2:return n=e.sent,e.next=5,Z.findAll({attributes:["id","nombre","uri","nombre_uri","icono","mostrar","orden","id_ruta_padre"],include:[{model:ie,where:{id:n},attributes:[]}],where:{id_ruta_padre:null,admin:r},order:["orden"]});case 5:return o=e.sent,e.next=8,Pt(St,St,Dt).call(St,o);case 8:return a=e.sent,e.abrupt("return",a);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Dt(e){return Ct.apply(this,arguments)}function Ct(){return Ct=O(R.mark((function e(t){var r,n,o,a,i,s;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=!1,n=!1,e.prev=2,a=At(t);case 4:return e.next=6,a.next();case 6:if(!(r=!(i=e.sent).done)){e.next=17;break}return s=i.value,e.next=10,Pt(St,St,Lt).call(St,s.id);case 10:if(s.rutas=e.sent,!s.rutas){e.next=14;break}return e.next=14,Pt(St,St,Dt).call(St,s.rutas);case 14:r=!1,e.next=4;break;case 17:e.next=23;break;case 19:e.prev=19,e.t0=e.catch(2),n=!0,o=e.t0;case 23:if(e.prev=23,e.prev=24,!r||null==a.return){e.next=28;break}return e.next=28,a.return();case 28:if(e.prev=28,!n){e.next=31;break}throw o;case 31:return e.finish(28);case 32:return e.finish(23);case 33:return e.abrupt("return",t);case 34:case"end":return e.stop()}}),e,null,[[2,19,23,33],[24,,28,32]])}))),Ct.apply(this,arguments)}function Lt(e){return Bt.apply(this,arguments)}function Bt(){return(Bt=O(R.mark((function e(t){var r;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z.findAll({include:[{model:ie,attributes:[]}],where:{id_ruta_padre:t},order:["orden"]});case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}St=zt;const Ht={$id:"http://example.com/schemas/rutaCreate.json#",type:"object",properties:{nombre:{type:"string",errorMessage:{type:"El nombre de la ruta debe ser de tipo alfanumerico"}},uri:{type:"string",errorMessage:{type:"La uri de la ruta debe ser de tipo alfanumerico"}},nombre_uri:{type:"string",errorMessage:{type:"El nombre de la ruta debe ser de tipo alfanumerico"}},mostrar:{type:"boolean",errorMessage:{type:"El parámetro mostrar de la ruta debe ser de tipo booleano"}},icono:{type:"string",errorMessage:{type:"El parámetro icono de la ruta debe ser de tipo alfanumerico"}},orden:{type:["number","null"],errorMessage:{type:"El parámetro orden de la ruta debe ser de tipo numérico"}},publico:{type:"boolean",errorMessage:{type:"El parámetro público de la ruta debe ser de tipo booleano"}},id_ruta_padre:{$ref:"defs.json#/definitions/intOrNull",errorMessage:{type:"El id de la ruta padre debe ser de tipo numérico"}}},required:["nombre","uri","mostrar","nombre_uri"],errorMessage:{required:{nombre:"El campo nombre de la ruta es requerido",mostrar:"El campo mostrar de la ruta es requerido",uri:"El campo uri de la ruta es requerido",nombre_uri:"El campo nombre_uri de la ruta es requerido"}}};var Gt=(0,l.Router)();Gt.get("/",[dt("ROLE_PATH_LIST")],ot(zt.index)),Gt.post("/",[dt("ROLE_PATH_CREATE"),K(Ht)],ot(zt.store)),Gt.get("/get-rutas",ot(zt.getRutas)),Gt.get("/:id",[dt("ROLE_PATH_LIST")],ot(zt.show)),Gt.put("/:id",[dt("ROLE_PATH_UPDATE"),K(Ht)],ot(zt.update));const Ut=Gt;function $t(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ft(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?$t(Object(r),!0).forEach((function(t){b(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$t(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Vt=function(){function e(){o(this,e)}var t,r,n,i,s;return a(e,null,[{key:"index",value:(s=O(R.mark((function e(t,r){var n,o,a,i,s,u,c,l,p,d,f;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.query,o=n.page,a=void 0===o?1:o,i=n.per_page,s=void 0===i?10:i,u=n.paginacion,l={},"true"===(c=void 0===u?"true":u)&&(st.isValid(s,"cantidad por pagina debe ser de tipo entero"),st.isValid(a,"pagina debe ser de tipo entero"),l.offset=s*(a-1),l.limit=Number(s),l.distinct=!0),e.next=5,we.findAndCountAll(Ft(Ft({},l),{},{include:[{model:be}]}));case 5:return p=e.sent,d=p.count,f=p.rows,"true"===c&&r.set({total_rows:Number(d),page:Number(a),per_page:Number(s)}),e.abrupt("return",r.status(_.HTTP_OK).json(f));case 10:case"end":return e.stop()}}),e)}))),function(e,t){return s.apply(this,arguments)})},{key:"create",value:(i=O(R.mark((function e(t,r){var n;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,we.create(t.body);case 2:return n=e.sent,e.abrupt("return",r.status(_.HTTP_OK).json(n));case 4:case"end":return e.stop()}}),e)}))),function(e,t){return i.apply(this,arguments)})},{key:"show",value:(n=O(R.mark((function e(t,r){var n;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,we.findByPk(t.params.id);case 2:return n=e.sent,e.abrupt("return",r.status(_.HTTP_OK).json(n));case 4:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"update",value:(r=O(R.mark((function e(t,r){var n;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,we.findByPk(t.params.id);case 2:return n=e.sent,e.next=5,n.update(t.body);case 5:return e.abrupt("return",r.status(_.HTTP_OK).json(n));case 6:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)})},{key:"destroy",value:(t=O(R.mark((function e(t,r){var n;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,we.findByPk(t.params.id);case 2:return n=e.sent,e.next=5,n.destroy();case 5:return e.abrupt("return",r.status(_.HTTP_OK).json(n));case 6:case"end":return e.stop()}}),e)}))),function(e,r){return t.apply(this,arguments)})}]),e}(),Zt=(0,l.Router)();Zt.get("/",ot(Vt.index)),Zt.post("/",ot(Vt.create)),Zt.get("/:id",ot(Vt.show)),Zt.put("/:id",ot(Vt.update)),Zt.delete("/:id",ot(Vt.destroy));const Qt=Zt;var Yt=function(){function e(){o(this,e)}var t,r,n,i;return a(e,null,[{key:"getTipoContribuyentes",value:(i=O(R.mark((function e(t,r){var n;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ge.findAll();case 2:return n=e.sent,e.abrupt("return",r.status(_.HTTP_OK).json(n));case 4:case"end":return e.stop()}}),e)}))),function(e,t){return i.apply(this,arguments)})},{key:"getTipoCuentas",value:(n=O(R.mark((function e(t,r){var n;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,be.findAll();case 2:return n=e.sent,e.abrupt("return",r.status(_.HTTP_OK).json(n));case 4:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"getTipoEmisionDocumentos",value:(r=O(R.mark((function e(t,r){var n;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ke.findAll();case 2:return n=e.sent,e.abrupt("return",r.status(_.HTTP_OK).json(n));case 4:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)})},{key:"verifyPersona",value:(t=O(R.mark((function e(t,r){var n,o;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.nit,e.next=3,Ie.findOne({where:{nit:n}});case 3:if(!(o=e.sent)){e.next=6;break}return e.abrupt("return",r.status(_.HTTP_OK).json(o));case 6:return e.abrupt("return",r.status(_.HTTP_OK).json());case 7:case"end":return e.stop()}}),e)}))),function(e,r){return t.apply(this,arguments)})}]),e}(),Jt=(0,l.Router)();Jt.get("/tipo-contribuyentes",ot(Yt.getTipoContribuyentes)),Jt.get("/tipo-cuentas",ot(Yt.getTipoCuentas)),Jt.get("/tipo-emision-documentos",ot(Yt.getTipoEmisionDocumentos)),Jt.get("/persona/:nit",ot(Yt.verifyPersona));const Wt=Jt,Xt=require("@babel/runtime/helpers/objectWithoutProperties");var er=["detalleVenta","persona","cuentas"],tr=["detalleVenta"];function rr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function nr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?rr(Object(r),!0).forEach((function(t){b(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var or=function(){function e(){o(this,e)}var t,r,n,i,s;return a(e,null,[{key:"index",value:(s=O(R.mark((function e(t,r){var n;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Oe.findAll({include:[{model:je}]});case 2:return n=e.sent,e.abrupt("return",r.status(_.HTTP_OK).json(n));case 4:case"end":return e.stop()}}),e)}))),function(e,t){return s.apply(this,arguments)})},{key:"create",value:(i=O(R.mark((function e(t,r){var n,o,a,i,s,u,c,l,p,d;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U.connection().transaction();case 2:return n=e.sent,e.prev=3,o=t.body,a=o.detalleVenta,i=o.persona,s=o.cuentas,u=Xt(o,er),c=null,e.next=8,Ie.findOne({where:{nit:i.nit}});case 8:if(!(l=e.sent)){e.next=15;break}return e.next=12,l.update(nr({},i),{transaction:n});case 12:c=e.sent,e.next=18;break;case 15:return e.next=17,Ie.create(nr({},i),{transaction:n});case 17:c=e.sent;case 18:return e.next=20,Me.create({},{transaction:n});case 20:return p=e.sent,e.next=23,De.bulkCreate(s.map((function(e){return nr(nr({},e),{},{id_transaccion:p.id})})),{transaction:n});case 23:return e.next=25,Oe.create(nr(nr({},u),{},{id_transaccion:p.id,id_persona:c.id}),{transaction:n});case 25:return d=e.sent,e.next=28,je.create(nr(nr({},a),{},{id_servicio:d.id}),{transaction:n});case 28:return e.next=30,n.commit();case 30:return e.abrupt("return",r.status(_.HTTP_OK).json(d));case 33:throw e.prev=33,e.t0=e.catch(3),n.rollback(),e.t0;case 37:case"end":return e.stop()}}),e,null,[[3,33]])}))),function(e,t){return i.apply(this,arguments)})},{key:"show",value:(n=O(R.mark((function e(t,r){var n;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Oe.findByPk(t.params.id,{include:[{model:je}]});case 2:return n=e.sent,e.abrupt("return",r.status(_.HTTP_OK).json(n));case 4:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"update",value:(r=O(R.mark((function e(t,r){var n,o,a,i;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Oe.findByPk(t.params.id);case 2:return n=e.sent,o=t.body,a=o.detalleVenta,i=Xt(o,tr),e.next=6,Oe.update(i,{where:{id:t.params.id}});case 6:return e.next=8,je.update(a,{where:{id:n.id_detalle_venta}});case 8:return e.abrupt("return",r.status(_.HTTP_OK).json(n));case 9:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)})},{key:"destroy",value:(t=O(R.mark((function e(t,r){var n;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Oe.findByPk(t.params.id);case 2:return n=e.sent,e.next=5,n.destroy();case 5:return e.abrupt("return",r.status(_.HTTP_OK).json(n));case 6:case"end":return e.stop()}}),e)}))),function(e,r){return t.apply(this,arguments)})}]),e}(),ar=(0,l.Router)();ar.get("/",ot(or.index)),ar.post("/",ot(or.create)),ar.get("/:id",ot(or.show)),ar.put("/:id",ot(or.update)),ar.delete("/:id",ot(or.destroy));const ir=ar;var sr=["detalleCompra","cuentas","persona"],ur=["detalleCompra","cuentas","persona"];function cr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function lr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?cr(Object(r),!0).forEach((function(t){b(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):cr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var pr=function(){function e(){o(this,e)}var t,r,n,i,s;return a(e,null,[{key:"index",value:(s=O(R.mark((function e(t,r){var n,o,a,i,s,u,c,l,p,d,f;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.query,o=n.page,a=void 0===o?1:o,i=n.per_page,s=void 0===i?10:i,u=n.paginacion,l={},"true"===(c=void 0===u?"true":u)&&(st.isValid(s,"cantidad por pagina debe ser de tipo entero"),st.isValid(a,"pagina debe ser de tipo entero"),l.offset=s*(a-1),l.limit=Number(s),l.distinct=!0),e.next=5,Ne.findAndCountAll(lr(lr({},l),{},{include:[{model:Pe},{model:Me,include:[{model:De}]},{model:Ie}]}));case 5:return p=e.sent,d=p.count,f=p.rows,"true"===c&&r.set({total_rows:Number(d),page:Number(a),per_page:Number(s)}),e.abrupt("return",r.status(_.HTTP_OK).json(f));case 10:case"end":return e.stop()}}),e)}))),function(e,t){return s.apply(this,arguments)})},{key:"create",value:(i=O(R.mark((function e(t,r){var n,o,a,i,s,u,c,l,p,d;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U.connection().transaction();case 2:return n=e.sent,e.prev=3,o=t.body,a=o.detalleCompra,i=o.cuentas,s=o.persona,u=Xt(o,sr),e.next=7,Me.create({},{transaction:n});case 7:return c=e.sent,e.next=10,De.bulkCreate(i.map((function(e){return lr(lr({},e),{},{id_transaccion:c.id})})),{transaction:n});case 10:return l=null,e.next=13,Ie.findOne({where:{nit:s.nit}});case 13:if(!(p=e.sent)){e.next=20;break}return e.next=17,p.update(lr({},s),{transaction:n});case 17:l=e.sent,e.next=23;break;case 20:return e.next=22,Ie.create(lr({},s),{transaction:n});case 22:l=e.sent;case 23:return e.next=25,Ne.create(lr(lr({},u),{},{id_transaccion:c.id,id_persona:l.id}),{transaction:n});case 25:return d=e.sent,e.next=28,Pe.create(lr(lr({},a),{},{id_compra:d.id}),{transaction:n});case 28:return e.next=30,n.commit();case 30:return e.abrupt("return",r.status(_.HTTP_OK).json(d));case 33:return e.prev=33,e.t0=e.catch(3),e.next=37,n.rollback();case 37:throw e.t0;case 38:case"end":return e.stop()}}),e,null,[[3,33]])}))),function(e,t){return i.apply(this,arguments)})},{key:"show",value:(n=O(R.mark((function e(t,r){var n;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ne.findByPk(t.params.id,{include:[{model:Pe},{model:Me,include:[{model:De}]},{model:Ie}]});case 2:return n=e.sent,e.abrupt("return",r.status(_.HTTP_OK).json(n));case 4:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"destroy",value:(r=O(R.mark((function e(t,r){var n;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ne.findByPk(t.params.id);case 2:return n=e.sent,e.next=5,n.destroy();case 5:return e.abrupt("return",r.status(_.HTTP_OK).json(n));case 6:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)})},{key:"update",value:(t=O(R.mark((function e(t,r){var n,o,a,i,s,u,c,l,p;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U.connection().transaction();case 2:return n=e.sent,e.prev=3,o=t.body,a=o.detalleCompra,i=o.cuentas,s=o.persona,u=Xt(o,ur),e.next=7,Ne.findByPk(t.params.id,{include:[{model:Pe},{model:Me,include:[{model:De}]}]});case 7:return c=e.sent,e.next=10,Ie.findOne({where:{nit:s.nit}});case 10:if(l=e.sent,p=null,!l){e.next=18;break}return e.next=15,l.update(lr({},s),{transaction:n});case 15:p=e.sent,e.next=21;break;case 18:return e.next=20,Ie.create(lr({},s),{transaction:n});case 20:p=e.sent;case 21:return e.next=23,c.update(lr(lr({},u),{},{id_persona:p.id}),{transaction:n});case 23:return e.next=25,Pe.update(lr({},a),{where:{id:c.DetalleCompra.id},transaction:n});case 25:return e.next=27,De.destroy({where:{id_transaccion:c.id_transaccion},transaction:n});case 27:return e.next=29,De.bulkCreate(i.map((function(e){return lr(lr({},e),{},{id_transaccion:c.id_transaccion})})),{transaction:n});case 29:return e.next=31,n.commit();case 31:return e.abrupt("return",r.status(_.HTTP_OK).json(c));case 34:return e.prev=34,e.t0=e.catch(3),e.next=38,n.rollback();case 38:throw e.t0;case 39:case"end":return e.stop()}}),e,null,[[3,34]])}))),function(e,r){return t.apply(this,arguments)})}]),e}(),dr=(0,l.Router)();dr.get("/",ot(pr.index)),dr.post("/",ot(pr.create)),dr.get("/:id",ot(pr.show)),dr.put("/:id",ot(pr.update)),dr.delete("/:id",ot(pr.destroy));const fr=dr;var mr=(0,l.Router)();mr.post("/v1/login",[K({$id:"http://example.com/schemas/login.json#",type:"object",properties:{email:{$ref:"defs.json#/definitions/email",errorMessage:{email:"El email debe ser de tipo alfanumerico"}},password:{$ref:"defs.json#/definitions/string"}},required:["email","password"],errorMessage:{required:{email:"El email es requerido",password:"La contraseña es requerida"}}})],ot(We.login)),mr.post("/v1/logout",[tt],ot(We.logout)),mr.get("/v1/2fa",[tt],ot(We.twoFactorList)),mr.post("/v1/2fa",[K({$id:"http://example.com/schemas/twoFactorAuth.json#",type:"object",properties:{id_metodo:{type:"integer",errorMessage:{email:"El id metodo de autenticación debe ser de tipo entero"}}},required:["id_metodo"],errorMessage:{required:{id_metodo:"El metodo de autenticación es requerido"}}})],ot(We.twoFactorAuthLoginChoose)),mr.post("/v1/2fa/verify",[nt],ot(We.verifyTwoFactorAuthCode)),mr.post("/v1/2fa/code",[nt],ot(We.sendCode)),mr.post("/v1/2fa/verification/token",ot(We.sendVerificationToken)),mr.get("/v1/verification/account/:token",ot(We.confirmUser)),mr.post("/v1/refresh",ot(We.RefreshToken)),mr.use("/v1/users",[tt],mt),mr.use("/v1/perfiles",[tt],Nt),mr.use("/v1/roles",[tt],wt),mr.use("/v1/tipo/roles",[tt],Et),mr.use("/v1/rutas",[tt],Ut),mr.put("/v1/password/change",[K({$id:"http://example.com/schemas/recoveryPasswordSchema.json#",type:"object",properties:{password:{$ref:"defs.json#/definitions/password"},confirm_password:{$ref:"defs.json#/definitions/password"}},required:["password","confirm_password"],errorMessage:{required:{password:"El campo password es requerido",confirm_password:"El campo confirmPassword es requerido"}}})],ot(We.changePassword)),mr.post("/v1/password/reset/",ot(We.resetPassword)),mr.use("/v1/cuentas",[tt],Qt),mr.use("/v1/catalogo",[tt],Wt),mr.use("/v1/servicios",[tt],ir),mr.use("/v1/compras",[tt],fr);const hr=mr;var yr=(0,l.Router)();yr.get("/",(function(e,t){t.send('<h1 style="color:red">Welcome</h1>')}));const vr=yr,br=require("http"),_r=require("cors"),wr=require("express-fileupload"),xr={origin:"*",methods:"GET,HEAD,PUT,PATCH,POST,DELETE",preflightContinue:!1,exposedHeaders:["page","per_page","total_rows"],optionsSuccessStatus:204},gr=new(function(){function e(){o(this,e),this.app=l(),this.server=(0,br.createServer)(this.app),this.port="8001",this.host="localhost",this.middlewares()}return a(e,[{key:"middlewares",value:function(){this.app.use(wr({createParentPath:!0})),this.app.use(_r(xr)),this.app.use(l.static("public")),this.app.use(l.json())}},{key:"start",value:function(){var e=this;this.server.listen(this.port,this.host,(function(){console.log("http://".concat(e.host,":").concat(e.port))}))}}]),e}()),Er=require("swagger-ui-express"),kr=require("yamljs"),Tr=require("url"),Or=require("js-yaml"),Rr=require("fs");var Nr=(0,t.dirname)((0,Tr.fileURLToPath)("file:///home/willian/Projects/ues/sic/api-sic/routes/swagger.mjs")),Sr=kr.load(t.join(Nr,"../app/docs/index.yaml")),jr=kr.load(t.join(Nr,"../app/docs/index.yaml")),qr=kr.load(t.join(Nr,"../app/docs/index.yaml")),Pr=(0,l.Router)();for(var Ar in qr.paths)delete qr.paths[Ar].area;var Ir=Or.dump(qr);for(var zr in Rr.writeFileSync(t.join(Nr,"../app/docs/test.yaml"),Ir,"utf8"),Sr.info.title="Documentación de la API de la Plantilla - Development",jr.paths)"development"===jr.paths[zr].area&&delete jr.paths[zr];for(var Mr in Sr.paths)"api"===Sr.paths[Mr].area&&delete Sr.paths[Mr];Pr.use("/local",Er.serveFiles(Sr),Er.setup(Sr)),Pr.use("/docs",Er.serveFiles(jr),Er.setup(jr)),Pr.use("/api/doc.json",(function(e,r){r.header("Content-Type","application/json"),r.sendFile(t.join(Nr,"../app/docs/test.json"))}));const Kr=Pr;new(function(){function e(){o(this,e),this.server=gr,this.configuracion(),this.server.start(),this.routes(),this.ExceptionConfig()}return a(e,[{key:"routes",value:function(){this.server.app.use("/",vr),this.server.app.use("/api",hr),this.server.app.use("/",Kr),this.server.app.all("*",(function(){throw new He}))}},{key:"configuracion",value:function(){var e=i(c);this.server.app.use(s(e)),this.server.app.use(u(e))}},{key:"ExceptionConfig",value:function(){this.server.app.use(z.logErrorMiddleware),this.server.app.use(z.handlerError)}}]),e}())})()})();